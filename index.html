<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-chrome-192x192.png">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    
    
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color>
    
    
    <link rel="manifest" href="/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/atom.xml" title="DeveloperTanliyuan" type="application/atom+xml">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/[object Object].css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/clipboard.min.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    
    <script defer type="text/javascript" src="/js/search.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/" + searchPath;
      searchFunc(path, "search-input", "search-result");
    });
    </script>
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var cb = null;
      var els = $(".post figure.highlight");
      if (els.length) {
        // Enabled Hexo highlight line number.
        $(els).each(function (i, e) {
          $(e).before("<button class=\"copy button\">复制</button>");
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              // nextElementSibling is figure,highlight.
              // And following is the sequence of Hexo's internal
              // highlight layout with line number.
              return trigger.nextElementSibling.firstChild.firstChild.firstChild.lastChild.firstChild.firstChild;
          }
        });
      } else {
        // Disabled Hexo highlight line number.
        els = $(".post pre code");
        $(els).each(function (i, e) {
          // Add button before pre, not code.
          $(e).parent().before("<button class=\"copy button\">复制</button>");
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              // nextElementSibling is figure,highlight.
              // And following is the sequence of Hexo's internal
              // highlight layout without line number.
              return trigger.nextElementSibling.firstChild;
          }
        });
      }
      cb.on("success", function (e) {
        e.clearSelection();
        var trigger = e.trigger;
        // Change button text as a user tip.
        trigger.innerHTML = "已复制";
        $(trigger).addClass("copied");
        // Change button text back;
        setTimeout(function () {
          trigger.innerHTML = "复制";
          $(trigger).removeClass("copied");
        }, 1500);
      });
    });
    </script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>DeveloperTanliyuan - 编程开发、分享生活、分享技术</title>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN" data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">DeveloperTanliyuan</a></h1>
        <h2 class="subtitle">编程开发、分享生活、分享技术</h2>
      </div>
      
      <div class="logo">
        <img src="/images/dog.gif" alt="logo">
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
        <li role="menuitem"><a href="/" class="current"><i class="fas fa-home"></i><span class="menu-text">首页</span></a></li>
        
        <li role="menuitem"><a href="/archives/"><i class="fas fa-archive"></i><span class="menu-text">归档</span></a></li>
        
        <li role="menuitem"><a href="/categories/"><i class="fas fa-th-list"></i><span class="menu-text">分类</span></a></li>
        
        <li role="menuitem"><a href="/tags/"><i class="fas fa-tags"></i><span class="menu-text">标签</span></a></li>
        
        <li role="menuitem"><a href="/about/"><i class="fas fa-user-edit"></i>favicons<span class="menu-text">关于</span></a></li>
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            

<div id="index" class="index page">
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2022/05/12/spring学习笔记/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2022/05/12/spring学习笔记/" itemprop="url">spring学习笔记</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-05-12T17:15:24+08:00">2022-05-12 17:15:24</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="容器接口"><a href="#容器接口" class="headerlink" title="容器接口"></a>容器接口</h1><h2 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h2><h3 id="什么是BeanFactory"><a href="#什么是BeanFactory" class="headerlink" title="什么是BeanFactory"></a>什么是BeanFactory</h3><p>1.它是ApplicationContext的父接口</p>
<p>2.它才是Spring的核心容器，主要的ApplicationContext实现都【组合】了它的功能，BeanFactory是ApplicationContext的成员变量</p>
<h3 id="BeanFactory能干啥"><a href="#BeanFactory能干啥" class="headerlink" title="BeanFactory能干啥"></a>BeanFactory能干啥</h3><p>1.表面上只有getBean方法</p>
<p>2.实际上，控制反转、基本的依赖注入，制止Bean的生命周期的各种功能，都由它的实现类提供例如DefaultListableBeanFactory，继承关系如下</p>
<p><img src="/images/pasted-1.png" alt="DefaultListableBeanFactory继承关系图"></p>
<h4 id="DefaultListableBeanFactory"><a href="#DefaultListableBeanFactory" class="headerlink" title="DefaultListableBeanFactory"></a>DefaultListableBeanFactory</h4><h5 id="DefaultSingletonBeanRegistry"><a href="#DefaultSingletonBeanRegistry" class="headerlink" title="DefaultSingletonBeanRegistry"></a>DefaultSingletonBeanRegistry</h5><p>该类有一个如下成员变量<br>private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap(256);<br>是私有的，我们可以通过反射的方式拿到它的成员变量</p>
<h2 id="ApplicationContext有哪些扩展功能"><a href="#ApplicationContext有哪些扩展功能" class="headerlink" title="ApplicationContext有哪些扩展功能"></a>ApplicationContext有哪些扩展功能</h2><p>org.springframework.boot.SpringApplication#run(java.lang.Class&lt;?&gt;, java.lang.String…)方法返回org.springframework.context.ConfigurableApplicationContext，我们来看一下他的接口继承关系</p>
<p><img src="/images/pasted-0.png" alt="ConfigurableApplicationContext继承关系图"></p>
<p>可以看出ApplicationContext间接继承了BeanFactory</p>
<p>ApplicationContext对BeanFactory进行了一些扩展,其中主要有(MessageSource、ResourcePatternResolver、ApplicationEventPublisher、EnviromentCapable)</p>
<h3 id="MessageSource"><a href="#MessageSource" class="headerlink" title="MessageSource"></a>MessageSource</h3><p>MessageSource提供了处理国际化的能力,国际化字典我们一半存储在resource目录下的messages开头的properties文件</p>
<p><img src="/images/pasted-2.png" alt="resource示例"></p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ConfigurableApplicationContext context = SpringApplication.run(MarketServerApplication.class);</span><br><span class="line">String hi = context.getMessage(<span class="string">"hi"</span>, <span class="keyword">null</span>, Locale.CHINA);</span><br><span class="line">System.out.println(hi);</span><br></pre></td></tr></table></figure>

<h3 id="ResourcePatternResolver"><a href="#ResourcePatternResolver" class="headerlink" title="ResourcePatternResolver"></a>ResourcePatternResolver</h3><p>ResourcePatternResolver资源文件的处理能力，如application.properties</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConfigurableApplicationContext context = SpringApplication.run(MarketServerApplication.class);</span><br><span class="line">Resource[] resources = context.getResources(&quot;classpath*:META-INF/spring.factories&quot;);</span><br><span class="line">for (Resource resource : resources) &#123;</span><br><span class="line">	System.out.println(resource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URL [jar:file:/Users/anakin/develop/mvn-repository/org/springframework/boot/spring-boot/2.3.12.RELEASE/spring-boot-2.3.12.RELEASE.jar!/META-INF/spring.factories]</span><br><span class="line">URL [jar:file:/Users/anakin/develop/mvn-repository/org/springframework/boot/spring-boot-autoconfigure/2.3.12.RELEASE/spring-boot-autoconfigure-2.3.12.RELEASE.jar!/META-INF/spring.factories]</span><br><span class="line">URL [jar:file:/Users/anakin/develop/mvn-repository/org/springframework/spring-beans/5.2.15.RELEASE/spring-beans-5.2.15.RELEASE.jar!/META-INF/spring.factories]</span><br></pre></td></tr></table></figure>

<h3 id="EnviromentCapable"><a href="#EnviromentCapable" class="headerlink" title="EnviromentCapable"></a>EnviromentCapable</h3><p>EnviromentCapable提供配置信息查看能力，可以是配置文件，也可以是环境变量（不区分大小写）等。</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(context.getEnviroment().getProperty(&quot;java_home&quot;));</span><br><span class="line">System.out.println(context.getEnviroment().getProperty(&quot;server.port&quot;));</span><br></pre></td></tr></table></figure>

<h3 id="ApplicationEventPublisher"><a href="#ApplicationEventPublisher" class="headerlink" title="ApplicationEventPublisher"></a>ApplicationEventPublisher</h3><p>ApplicationEventPublisher提供事件发布的能力</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Event event = new Event();</span><br><span class="line">applicationContext.publishEvent(event);</span><br></pre></td></tr></table></figure>

<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@EventListener</span><br><span class="line">public void listenEvent(Event event)&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="容器实现"><a href="#容器实现" class="headerlink" title="容器实现"></a>容器实现</h2><h3 id="BeanFactory实现的特点"><a href="#BeanFactory实现的特点" class="headerlink" title="BeanFactory实现的特点"></a>BeanFactory实现的特点</h3><blockquote>
<p>BeanFactory不会主动做的事情</p>
</blockquote>
<blockquote>
<blockquote>
<p>不会主动调用BeanFactory后处理器</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>不会主动添加Bean后处理器</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>不会主动初始化单例对象</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>不会解析BeanFactory，还不会解析${}与#{}</p>
</blockquote>
</blockquote>
<blockquote>
<p>Bean后处理器有排序的逻辑</p>
</blockquote>
<h4 id="DefaultListableBeanFactory-1"><a href="#DefaultListableBeanFactory-1" class="headerlink" title="DefaultListableBeanFactory"></a>DefaultListableBeanFactory</h4><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();</span><br><span class="line">    // bean 的定义（class,scope,初始化,销毁)</span><br><span class="line">    AbstractBeanDefinition beanDefinition = BeanDefinitionBuilder.genericBeanDefinition(Config.class).setScope(&quot;singleton).getBeanDefinition();</span><br><span class="line">    // 给BeanFactory添加一些常用的后置处理器(如@Configuration、@Bean等等扩展功能)</span><br><span class="line">    AnnotationConfigUtils.registerAnnotationConfigProcessors(beanFactory);</span><br><span class="line">    // 执行Bean工厂后置处理器</span><br><span class="line">    Map&lt;String, BeanFactoryPostProcessor&gt; beansOfType = beanFactory.getBeansOfType(BeanFactoryPostProcessor.class);</span><br><span class="line">    beansOfType.values().stream().forEach(beanFactoryPostProcessor -&gt; beanFactoryPostProcessor.postProcessBeanFactory(context.getBeanFactory()));</span><br><span class="line">    // 添加Bean后置处理器与bean工厂的联系（针对Bean生命周期的各个阶段提供扩展，例如@Autowired、@Resource等）</span><br><span class="line">    beanFactory.getBeansOfType(BeanPostProcessor.class).values().forEach(beanFactory::addBeanPostProcessor);</span><br><span class="line">    // beanFactory默认延迟创建对象，我们可以执行下面的方法提前创建对象</span><br><span class="line">    beanFactory.preInstantiateSingletons();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上添加的后置处理器如下(Bean工厂后置处理器及Bean后置处理器都有)</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerFactory</span><br></pre></td></tr></table></figure>

<p>常见的Bean工厂后置处理器</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.annotation.internalConfigurationAnnotationProcessor------&gt;org.springframework.context.annotation.ConfigurationClassPostProcessor@2b27d5d3</span><br><span class="line">org.springframework.context.event.internalEventListenerProcessor------&gt;org.springframework.context.event.EventListenerMethodProcessor@12115c28</span><br><span class="line">propertySourcesPlaceholderConfigurer------&gt;org.springframework.context.support.PropertySourcesPlaceholderConfigurer@cc3fc5c</span><br><span class="line">preserveErrorControllerTargetClassPostProcessor------&gt;org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration$PreserveErrorControllerTargetClassPostProcessor@2aac60b</span><br><span class="line">cn.hutool.extra.spring.SpringUtil------&gt;cn.hutool.extra.spring.SpringUtil@173602c0</span><br><span class="line">org.springframework.cloud.autoconfigure.RefreshAutoConfiguration$RefreshScopeBeanDefinitionEnhancer------&gt;org.springframework.cloud.autoconfigure.RefreshAutoConfiguration$RefreshScopeBeanDefinitionEnhancer@fdeec12</span><br><span class="line">refreshScope------&gt;org.springframework.cloud.context.scope.refresh.RefreshScope@de579ff</span><br></pre></td></tr></table></figure>

<p>常见的Bean后置处理器</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.annotation.internalAutowiredAnnotationProcessor------&gt;org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor@6fe55fcf</span><br><span class="line">org.springframework.context.annotation.internalCommonAnnotationProcessor------&gt;org.springframework.context.annotation.CommonAnnotationBeanPostProcessor@4d1f6e1c</span><br><span class="line">org.springframework.aop.config.internalAutoProxyCreator------&gt;proxyTargetClass=true; optimize=false; opaque=false; exposeProxy=false; frozen=false</span><br><span class="line">org.springframework.boot.context.properties.ConfigurationPropertiesBindingPostProcessor------&gt;org.springframework.boot.context.properties.ConfigurationPropertiesBindingPostProcessor@3431cb1f</span><br><span class="line">webServerFactoryCustomizerBeanPostProcessor------&gt;org.springframework.boot.web.server.WebServerFactoryCustomizerBeanPostProcessor@42c9f2cd</span><br><span class="line">errorPageRegistrarBeanPostProcessor------&gt;org.springframework.boot.web.server.ErrorPageRegistrarBeanPostProcessor@797c67c</span><br><span class="line">methodValidationPostProcessor------&gt;proxyTargetClass=true; optimize=false; opaque=false; exposeProxy=false; frozen=false</span><br><span class="line">dataSourceInitializerPostProcessor------&gt;org.springframework.boot.autoconfigure.jdbc.DataSourceInitializerPostProcessor@31ce271c</span><br><span class="line">org.springframework.amqp.rabbit.config.internalRabbitListenerAnnotationProcessor------&gt;org.springframework.amqp.rabbit.annotation.RabbitListenerAnnotationBeanPostProcessor@b1d7b09</span><br><span class="line">healthEndpointGroupsBeanPostProcessor------&gt;org.springframework.boot.actuate.autoconfigure.health.HealthEndpointConfiguration$HealthEndpointGroupsBeanPostProcessor@64faf3d</span><br><span class="line">meterRegistryPostProcessor------&gt;org.springframework.boot.actuate.autoconfigure.metrics.MeterRegistryPostProcessor@3f523dae</span><br><span class="line">rabbitConnectionFactoryMetricsPostProcessor------&gt;org.springframework.boot.actuate.autoconfigure.metrics.amqp.RabbitConnectionFactoryMetricsPostProcessor@7fe40b9f</span><br><span class="line">persistenceExceptionTranslationPostProcessor------&gt;proxyTargetClass=true; optimize=false; opaque=false; exposeProxy=false; frozen=false</span><br><span class="line">projectingArgumentResolverBeanPostProcessor------&gt;org.springframework.data.web.config.ProjectingArgumentResolverRegistrar$ProjectingArgumentResolverBeanPostProcessor@1f41f259</span><br><span class="line">configurationPropertiesBeans------&gt;org.springframework.cloud.context.properties.ConfigurationPropertiesBeans@648c80cb</span><br><span class="line">org.springframework.context.annotation.internalAsyncAnnotationProcessor------&gt;proxyTargetClass=false; optimize=false; opaque=false; exposeProxy=false; frozen=false</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-3.png" alt="一些Bean工厂后置处理器的实现类图"></p>
<p><img src="/images/pasted-4.png" alt="一些Bean后置处理器的实现类图"></p>
<h3 id="ApplicationContext的常见实现与特点"><a href="#ApplicationContext的常见实现与特点" class="headerlink" title="ApplicationContext的常见实现与特点"></a>ApplicationContext的常见实现与特点</h3><p><img src="/images/pasted-5.png" alt="ApplicationContext实现关系图"></p>
<h3 id="内嵌容器注册DispatcherServlet"><a href="#内嵌容器注册DispatcherServlet" class="headerlink" title="内嵌容器注册DispatcherServlet"></a>内嵌容器注册DispatcherServlet</h3>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2021/09/18/使用Golang实现一个Web服务器/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2021/09/18/使用Golang实现一个Web服务器/" itemprop="url">使用Golang实现一个Web服务器</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2021-09-18T02:16:24+08:00">2021-09-18 02:16:24</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <blockquote>
<p>废话少说直接看代码</p>
</blockquote>
 <figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"> package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;encoding/json&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">/***********************服务器抽象***********************/</span><br><span class="line">// Server 抽象服务器</span><br><span class="line">type Server interface &#123;</span><br><span class="line">	// Route 设定一个路由，命中该路由的会执行handleFunc的代码</span><br><span class="line">	Route(pattern string, handleFunc http.HandlerFunc)</span><br><span class="line"></span><br><span class="line">	// Start 启动我们的服务器</span><br><span class="line">	Start(address string) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/***********************服务器实现***********************/</span><br><span class="line">type sdkHttpServer struct &#123;</span><br><span class="line">	Name string // Name 服务器应用名称查看方法 NewSdkHttpServer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Route 设定一个路由，命中该路由的会执行handleFunc的代码 实现了Server接口</span><br><span class="line">func (server *sdkHttpServer) Route(pattern string, handleFunc http.HandlerFunc) &#123;</span><br><span class="line">	http.HandleFunc(pattern, handleFunc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Start 启动我们的服务器</span><br><span class="line">func (server *sdkHttpServer) Start(address string) error &#123;</span><br><span class="line">	return http.ListenAndServe(&quot;:8080&quot;, nil)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewSdkHttpServer 新建名为name的sdkHttpServer</span><br><span class="line">func NewSdkHttpServer(name string) Server &#123;</span><br><span class="line">	return &amp;sdkHttpServer&#123;Name: name&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/********************HttpContext抽象********************/</span><br><span class="line">type Context struct &#123;</span><br><span class="line">	writer  http.ResponseWriter</span><br><span class="line">	request *http.Request</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewContext 构造方法</span><br><span class="line">func NewContext(writer http.ResponseWriter, request *http.Request) *Context &#123;</span><br><span class="line">	return &amp;Context&#123;writer: writer, request: request&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ReadJson 读取request请求发过来的json数据</span><br><span class="line">func (context *Context) ReadJson(data interface&#123;&#125;) error &#123;</span><br><span class="line">	body, err := io.ReadAll(context.request.Body)</span><br><span class="line">	//读流错误</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	return json.Unmarshal(body, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// WriteJson 响应Json数据</span><br><span class="line">func (context *Context) WriteJson(status int, data interface&#123;&#125;) error &#123;</span><br><span class="line">	bytes, err := json.Marshal(data)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	_, err = context.writer.Write(bytes)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	context.writer.WriteHeader(status)</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// OkJson 请求成功</span><br><span class="line">func (context Context) OkJson(data interface&#123;&#125;) error &#123;</span><br><span class="line">	return context.WriteJson(http.StatusOK, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// SystemErrJson 系统内部异常</span><br><span class="line">func (context Context) SystemErrJson(data interface&#123;&#125;) error &#123;</span><br><span class="line">	return context.WriteJson(http.StatusInternalServerError, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// BadRequestJson 错误的请求数据</span><br><span class="line">func (context Context) BadRequestJson(data interface&#123;&#125;) error &#123;</span><br><span class="line">	return context.WriteJson(http.StatusBadRequest, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**********************响应实体封装**********************/</span><br><span class="line">// commonResponse 公共的响应结果包装</span><br><span class="line">type commonResponse struct &#123;</span><br><span class="line">	Code int         `json:&quot;code&quot;`</span><br><span class="line">	Msg  string      `json:&quot;msg&quot;`</span><br><span class="line">	Data interface&#123;&#125; `json:&quot;data&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/***********************请求的实体***********************/</span><br><span class="line">type signUpReq struct &#123;</span><br><span class="line">	Email             string `json:&quot;email&quot;`</span><br><span class="line">	Password          string `json:&quot;password&quot;`</span><br><span class="line">	ConfirmedPassword string `json:&quot;confirmed_password&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**********************路由处理方法**********************/</span><br><span class="line">// handler</span><br><span class="line">func handler(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">	fmt.Fprintf(writer, &quot;Hi there, I love %s!&quot;, request.URL.Path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// parseForm</span><br><span class="line">func parseForm(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">	fmt.Fprintf(writer, &quot;before parse form %v\n&quot;, request.Form)</span><br><span class="line">	err := request.ParseForm()</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		fmt.Fprintf(writer, &quot;parse form error %v\n&quot;, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Fprintf(writer, &quot;before parse form %v&quot;, request.Form)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// signUp 用户注册</span><br><span class="line">func signUp(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">	context := NewContext(writer, request)</span><br><span class="line">	req := &amp;signUpReq&#123;&#125;</span><br><span class="line">	err := context.ReadJson(req)</span><br><span class="line">	// 没有读到json请求错误</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		context.BadRequestJson(&amp;commonResponse&#123;</span><br><span class="line">			Code: 400,</span><br><span class="line">			Msg:  fmt.Sprintf(&quot;intalid request %v&quot;, err),</span><br><span class="line">		&#125;)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	_ = context.OkJson(&amp;commonResponse&#123;Code: 0, Msg: &quot;success&quot;, Data: req&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// main 程序入口</span><br><span class="line">func main() &#123;</span><br><span class="line">	httpServer := NewSdkHttpServer(&quot;test&quot;)</span><br><span class="line">	httpServer.Route(&quot;/&quot;, handler)</span><br><span class="line">	httpServer.Route(&quot;/parseForm&quot;, parseForm)</span><br><span class="line">	httpServer.Route(&quot;/signUp&quot;, signUp)</span><br><span class="line">	httpServer.Start(&quot;:8080&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2021/08/06/JVM知识体系/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2021/08/06/JVM知识体系/" itemprop="url">JVM知识体系</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2021-08-06T21:38:09+08:00">2021-08-06 21:38:09</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h2 id="认识JVM"><a href="#认识JVM" class="headerlink" title="认识JVM"></a>认识JVM</h2><p>认识JVM规范：重点是理解JVM规范的作用，了解JVM规范的主要内容</p>
<p>认识JVM：是什么、有什么、能干什么<br>JVM:Java virtual machine,也就是java虚拟机</p>
<p>所谓的虚拟机是指：通过软件模拟的具有完整硬件系统功能、运行在一个完全隔离环境中的计算机系统</p>
<p>JVM是通过软件来模拟Java字节玛的指令集，是Java程序运行的环境</p>
<p>java如何实现平台无关</p>
<p><img src="/images/img_47.png" alt="JVM概述图"></p>
<p>JVM主要功能<br>1、通过ClassLoader寻找和装在class文件<br>2、解释字节码成为指令并执行，提供class文件运行环境<br>3、运行期间内存非配<br>4、提供硬件交互的平台</p>
<p>虚拟机是平台无关的保障</p>
<p><img src="/images/img_49.png" alt="虚拟机是平台无关的保障"></p>
<p>JVM规范作用<br>1.Java虚拟机规范为不同的硬件平台提供了一种编译Java技术代码的规范。<br>2.该规范使用Java软件独立于平台，因为编译是针对作为虚拟机的“一般机器”而做。<br>3.这个“一般机器”可用软件模拟并运行于各种现存的计算机系统，也可用硬件来实现。</p>
<p>JVM规范定义的主要内容<br>字节码指令集（相当于中央处理器CPU）,详看JVM虚拟机规范<br>class文件格式<br>数据类型和值，详看JVM虚拟机规范<br>运行时数据区<br>栈帧<br>特殊方法<br>    &lt;init&gt;:实例初始化方法，通过invokespecial指令来调用<br>    &lt;clinit&gt;:类或接口的初始化方法，不包含参数，返回void<br>类库<br>      Java虚拟机必须要对一些Java类库提供支持，否则这些类库根本无法实现，比如（反射、加载和创建类或接口，如ClassLoader、连接或初始化类和接口的类、安全，如security、多线程、弱引用）<br>异常处理<br>虚拟机的启动、加载、链接和初始化</p>
<p>Java虚拟机规范下载地址<br><a href="https://docs.oracle.com/javase/specs/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/specs/index.html</a></p>
<h2 id="class文件格式"><a href="#class文件格式" class="headerlink" title="class文件格式"></a>class文件格式</h2><ul>
<li><p>class文件是JVM的输入，Java虚拟机规范中定义了Class文件结构。Class文件Jvm实现平台无关、技术无关的基础</p>
<ul>
<li><p>1.class文件是一组以8字节为单位的字节流，各个数据项目按顺序紧凑排列</p>
</li>
<li><p>2.对于占用空间大于8字节的数据项，按照高位在前的方式分割成多个8字节进行存储</p>
</li>
<li><p>3.class文件格式里面只有两种类型：无符号数、表，详看JVM虚拟机规范</p>
<ul>
<li><p>（1）无符号数：基本数据类型，以u1、u2、u4、u8来代表几个字节的无符号数</p>
</li>
<li><p>（2）表：由多个无符号数和其他表构成的符合数据类型，通常以“_info”结尾</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>javap工具生成非正式的“虚拟机汇编语言”，格式如下</p>
</li>
</ul>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;index&gt; &lt;opcode&gt; [&lt;operand1&gt; [&lt;operand2&gt; ...]][&lt;comment&gt;]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>&lt;index&gt;是指令操作码在数组种的下标，该数组以字节的形式存储当前方法的Java虚拟机代码；也可以是相对方法起始处的字节偏移量</p>
</li>
<li><p>&lt;opcode&gt;是指令的助记码、&lt;operand&gt;是操作数、&lt;comment&gt;是注释</p>
</li>
</ul>
<h3 id="class文件格式说明"><a href="#class文件格式说明" class="headerlink" title="class文件格式说明"></a>class文件格式说明</h3><ul>
<li><p>constant_pool_count:是从1开始的</p>
</li>
<li><p>不同的常亮类型，用tag来区分的，它后面对应的info结构是不一样的</p>
</li>
<li><p>L表示对象，[表示数组，V表示void</p>
</li>
<li><p>了解预定义attribute的含义</p>
</li>
<li><p>stack:方法执行时，操作栈的深度</p>
</li>
<li><p>Locals：局部变量所需的存储空间，单位是slot</p>
</li>
<li><p>slot：是虚拟机为局部变量分配内存所使用的最小单位</p>
</li>
<li><p>arg_size：参数个数，为1的话，因实例方法会默认传入this，locals也会预留一个slot来存放</p>
</li>
</ul>
<p>TestJVM.java原始文件</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package world.ismyfree.demo;</span><br><span class="line"></span><br><span class="line">public class TestJvm &#123;</span><br><span class="line"></span><br><span class="line">    public static final     String HELLO_JAVA = &quot;hello java&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(String.format(&quot;get message = %s&quot;, HELLO_JAVA));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TestJVM.class原始文件</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">cafe babe 0000 0034 002d 0a00 0400 1909</span><br><span class="line">001a 001b 0800 1c07 001d 0700 1e08 001f</span><br><span class="line">0a00 2000 210a 0022 0023 0100 0a48 454c</span><br><span class="line">4c4f 5f4a 4156 4101 0012 4c6a 6176 612f</span><br><span class="line">6c61 6e67 2f53 7472 696e 673b 0100 0d43</span><br><span class="line">6f6e 7374 616e 7456 616c 7565 0100 063c</span><br><span class="line">696e 6974 3e01 0003 2829 5601 0004 436f</span><br><span class="line">6465 0100 0f4c 696e 654e 756d 6265 7254</span><br><span class="line">6162 6c65 0100 124c 6f63 616c 5661 7269</span><br><span class="line">6162 6c65 5461 626c 6501 0004 7468 6973</span><br><span class="line">0100 1d4c 776f 726c 642f 6973 6d79 6672</span><br><span class="line">6565 2f64 656d 6f2f 5465 7374 4a76 6d3b</span><br><span class="line">0100 046d 6169 6e01 0016 285b 4c6a 6176</span><br><span class="line">612f 6c61 6e67 2f53 7472 696e 673b 2956</span><br><span class="line">0100 0461 7267 7301 0013 5b4c 6a61 7661</span><br><span class="line">2f6c 616e 672f 5374 7269 6e67 3b01 000a</span><br><span class="line">536f 7572 6365 4669 6c65 0100 0c54 6573</span><br><span class="line">744a 766d 2e6a 6176 610c 000c 000d 0700</span><br><span class="line">240c 0025 0026 0100 1067 6574 206d 6573</span><br><span class="line">7361 6765 203d 2025 7301 0010 6a61 7661</span><br><span class="line">2f6c 616e 672f 4f62 6a65 6374 0100 1b77</span><br><span class="line">6f72 6c64 2f69 736d 7966 7265 652f 6465</span><br><span class="line">6d6f 2f54 6573 744a 766d 0100 0a68 656c</span><br><span class="line">6c6f 206a 6176 6107 0027 0c00 2800 2907</span><br><span class="line">002a 0c00 2b00 2c01 0010 6a61 7661 2f6c</span><br><span class="line">616e 672f 5379 7374 656d 0100 036f 7574</span><br><span class="line">0100 154c 6a61 7661 2f69 6f2f 5072 696e</span><br><span class="line">7453 7472 6561 6d3b 0100 106a 6176 612f</span><br><span class="line">6c61 6e67 2f53 7472 696e 6701 0006 666f</span><br><span class="line">726d 6174 0100 3928 4c6a 6176 612f 6c61</span><br><span class="line">6e67 2f53 7472 696e 673b 5b4c 6a61 7661</span><br><span class="line">2f6c 616e 672f 4f62 6a65 6374 3b29 4c6a</span><br><span class="line">6176 612f 6c61 6e67 2f53 7472 696e 673b</span><br><span class="line">0100 136a 6176 612f 696f 2f50 7269 6e74</span><br><span class="line">5374 7265 616d 0100 0770 7269 6e74 6c6e</span><br><span class="line">0100 1528 4c6a 6176 612f 6c61 6e67 2f53</span><br><span class="line">7472 696e 673b 2956 0021 0005 0004 0000</span><br><span class="line">0001 0019 0009 000a 0001 000b 0000 0002</span><br><span class="line">0006 0002 0001 000c 000d 0001 000e 0000</span><br><span class="line">002f 0001 0001 0000 0005 2ab7 0001 b100</span><br><span class="line">0000 0200 0f00 0000 0600 0100 0000 0300</span><br><span class="line">1000 0000 0c00 0100 0000 0500 1100 1200</span><br><span class="line">0000 0900 1300 1400 0100 0e00 0000 4300</span><br><span class="line">0600 0100 0000 15b2 0002 1203 04bd 0004</span><br><span class="line">5903 1206 53b8 0007 b600 08b1 0000 0002</span><br><span class="line">000f 0000 000a 0002 0000 0008 0014 0009</span><br><span class="line">0010 0000 000c 0001 0000 0015 0015 0016</span><br><span class="line">0000 0001 0017 0000 0002 0018</span><br></pre></td></tr></table></figure>

<p>javap -verbose TestJVM.class(助记符)</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">Classfile /home/anakin/IdeaProjects/untitled/target/classes/world/ismyfree/demo/TestJvm.class</span><br><span class="line">  Last modified 2021-8-8; size 764 bytes</span><br><span class="line">  MD5 checksum b5c5da06a2ed9a50c599a61bf2f71066</span><br><span class="line">  Compiled from &quot;TestJvm.java&quot;</span><br><span class="line">public class world.ismyfree.demo.TestJvm</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #4.#25         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = Fieldref           #26.#27        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #3 = String             #28            // get message = %s</span><br><span class="line">   #4 = Class              #29            // java/lang/Object</span><br><span class="line">   #5 = Class              #30            // world/ismyfree/demo/TestJvm</span><br><span class="line">   #6 = String             #31            // hello java</span><br><span class="line">   #7 = Methodref          #32.#33        // java/lang/String.format:(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</span><br><span class="line">   #8 = Methodref          #34.#35        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   #9 = Utf8               HELLO_JAVA</span><br><span class="line">  #10 = Utf8               Ljava/lang/String;</span><br><span class="line">  #11 = Utf8               ConstantValue</span><br><span class="line">  #12 = Utf8               &lt;init&gt;</span><br><span class="line">  #13 = Utf8               ()V</span><br><span class="line">  #14 = Utf8               Code</span><br><span class="line">  #15 = Utf8               LineNumberTable</span><br><span class="line">  #16 = Utf8               LocalVariableTable</span><br><span class="line">  #17 = Utf8               this</span><br><span class="line">  #18 = Utf8               Lworld/ismyfree/demo/TestJvm;</span><br><span class="line">  #19 = Utf8               main</span><br><span class="line">  #20 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #21 = Utf8               args</span><br><span class="line">  #22 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #23 = Utf8               SourceFile</span><br><span class="line">  #24 = Utf8               TestJvm.java</span><br><span class="line">  #25 = NameAndType        #12:#13        // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #26 = Class              #36            // java/lang/System</span><br><span class="line">  #27 = NameAndType        #37:#38        // out:Ljava/io/PrintStream;</span><br><span class="line">  #28 = Utf8               get message = %s</span><br><span class="line">  #29 = Utf8               java/lang/Object</span><br><span class="line">  #30 = Utf8               world/ismyfree/demo/TestJvm</span><br><span class="line">  #31 = Utf8               hello java</span><br><span class="line">  #32 = Class              #39            // java/lang/String</span><br><span class="line">  #33 = NameAndType        #40:#41        // format:(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</span><br><span class="line">  #34 = Class              #42            // java/io/PrintStream</span><br><span class="line">  #35 = NameAndType        #43:#44        // println:(Ljava/lang/String;)V</span><br><span class="line">  #36 = Utf8               java/lang/System</span><br><span class="line">  #37 = Utf8               out</span><br><span class="line">  #38 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #39 = Utf8               java/lang/String</span><br><span class="line">  #40 = Utf8               format</span><br><span class="line">  #41 = Utf8               (Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</span><br><span class="line">  #42 = Utf8               java/io/PrintStream</span><br><span class="line">  #43 = Utf8               println</span><br><span class="line">  #44 = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  public static final java.lang.String HELLO_JAVA;</span><br><span class="line">    descriptor: Ljava/lang/String;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: String hello java</span><br><span class="line"></span><br><span class="line">  public world.ismyfree.demo.TestJvm();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lworld/ismyfree/demo/TestJvm;</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=6, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #3                  // String get message = %s</span><br><span class="line">         5: iconst_1</span><br><span class="line">         6: anewarray     #4                  // class java/lang/Object</span><br><span class="line">         9: dup</span><br><span class="line">        10: iconst_0</span><br><span class="line">        11: ldc           #6                  // String hello java</span><br><span class="line">        13: aastore</span><br><span class="line">        14: invokestatic  #7                  // Method java/lang/String.format:(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</span><br><span class="line">        17: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        20: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 8: 0</span><br><span class="line">        line 9: 20</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0      21     0  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;TestJvm.java&quot;</span><br></pre></td></tr></table></figure>

<h2 id="ASM开发"><a href="#ASM开发" class="headerlink" title="ASM开发"></a>ASM开发</h2><h3 id="认识ASM"><a href="#认识ASM" class="headerlink" title="认识ASM"></a>认识ASM</h3><ul>
<li><p>ASM是一个Java字节码操纵框架，它能用来动态生成类或者增强既有类的功能</p>
</li>
<li><p>ASM能直接产生二进制class文件，也可以在类被加入虚拟机之前动态改变类行为，ASM类文件读入信息后，能够改变类行为，分析类信息，甚至能根据要求生成新类。</p>
</li>
<li><p>目前许多框架如cglib、Hibernate、Spring都直接或间接地使用ASM操作字节码</p>
</li>
</ul>
<h3 id="ASM编程模型"><a href="#ASM编程模型" class="headerlink" title="ASM编程模型"></a>ASM编程模型</h3><ul>
<li><p>Core API：提供了基于事件形式的编程模型。该模型不需要一次性将整个类的结构读取到内存中，因此这种方式更快，需要更少的内存，但这种编程方式难度较大。</p>
</li>
<li><p>Tree API：提供了基于树形的编程模型。该模型需要一次性将一个类的完整结构全部读取到内存当中，所以这种方法需要更多的内存，这种编程方式较简单。</p>
</li>
</ul>
<h3 id="ASM核心API"><a href="#ASM核心API" class="headerlink" title="ASM核心API"></a>ASM核心API</h3><h4 id="ASM的Core-API"><a href="#ASM的Core-API" class="headerlink" title="ASM的Core API"></a>ASM的Core API</h4><ul>
<li><p>ASM Core API种操纵字节码的功能基于ClassVisitor接口。这个接口种的每个方法对应了class中的每一项。</p>
</li>
<li><p>ASM提供了三个基于ClassVisitor接口的类实现class文件的生成和转换</p>
<ul>
<li><p>1.ClassReader：ClassReader解析一个类的class字节码</p>
</li>
<li><p>2.ClassAdapter：ClassAdapter是ClassVisitor的实现类，实现要变化的功能</p>
</li>
<li><p>3.ClassWriter：ClassWriter也是ClassVisitor的实现类，可以用来输出要变化的字节码</p>
</li>
</ul>
</li>
</ul>
<h4 id="ASMifier"><a href="#ASMifier" class="headerlink" title="ASMifier"></a>ASMifier</h4><ul>
<li><p>1.ASM给我们提供了ASMifier工具帮助开发，可以使用ASMifier工具生成ASM结构来对比</p>
</li>
<li><p>2.工具Maven依赖</p>
</li>
</ul>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;asm&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;9.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;asm-util&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;9.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>3.idea使用maven命令将jar包copy到当前项目的dependency目录方便调试</li>
</ul>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:copy-dependencies</span><br></pre></td></tr></table></figure>

<ul>
<li>4.执行命令使用工具解析字节码</li>
</ul>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp .:../dependency/asm-9.2.jar:../dependency/asm-util-9.2.jar org.objectweb.asm.util.ASMifier world.ismyfree.jvm.asm.CC</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2021/03/01/mysql查询时间日期转换/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2021/03/01/mysql查询时间日期转换/" itemprop="url">mysql查询时间日期转换</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2021-03-01T23:09:04+08:00">2021-03-01 23:09:04</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <blockquote>
<p>转换示例如下</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	order_id orderId,</span><br><span class="line">	REPLACE(REPLACE(FROM_UNIXTIME(order_time/1000,&apos;%Y%m%D%H:%i&apos;),&apos;th&apos;,&apos;&apos;),&apos;:&apos;,&apos;&apos;) AS orderTime,</span><br><span class="line">	&quot;202102&quot; AS orderMonth </span><br><span class="line">FROM</span><br><span class="line">	mall_order_sku_202102 as t1</span><br><span class="line">WHERE</span><br><span class="line">	sku_id = 10023919984358 </span><br><span class="line">	AND order_time &gt;= 1614355200000 </span><br><span class="line">	AND order_time &lt; 1614441600000</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2021/01/28/使用Nginx配置HTTPS域名证书/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2021/01/28/使用Nginx配置HTTPS域名证书/" itemprop="url">使用Nginx配置HTTPS域名证书</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2021-01-28T14:43:23+08:00">2021-01-28 14:43:23</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="配置ssl域名证书"><a href="#配置ssl域名证书" class="headerlink" title="配置ssl域名证书"></a>配置ssl域名证书</h1><blockquote>
<p>参考阿里云帮助文档<a href="https://help.aliyun.com/document_detail/98728.html?spm=5176.11065259.1996646101.searchclickresult.7f092f78xxRTpU" target="_blank" rel="noopener">在Nginx（或Tengine）服务器上安装证书</a></p>
</blockquote>
<h2 id="下载证书到本地"><a href="#下载证书到本地" class="headerlink" title="下载证书到本地"></a>下载证书到本地</h2><blockquote>
<p>去域名服务提供商申请域名证书（腾讯云与阿里云都可以申请免费的域名证书）</p>
</blockquote>
<p><img src="/images/img_41.png" alt="下载域名证书"></p>
<h2 id="上传证书文件到服务器"><a href="#上传证书文件到服务器" class="headerlink" title="上传证书文件到服务器"></a>上传证书文件到服务器</h2><blockquote>
<p>例如使用CRT附带的文件上传工具将证书文件上传到/usr/local/nginx/conf/cert目录下面</p>
</blockquote>
<blockquote>
<p>在nginx配置文件中添加配置（如下配置是根据nginx注释掉的默认配置直接修改而来,或参考上面提到的阿里云的文档）</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  www.ismyfree.world;</span><br><span class="line"></span><br><span class="line">    ssl_certificate      /usr/local/nginx/conf/cert/4810494_www.ismyfree.world.pem;</span><br><span class="line">    ssl_certificate_key  /usr/local/nginx/conf/cert/4810494_www.ismyfree.world.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本次演示基于本地服务器（无意义），正常情况下我们是通过现有的与服务器进行配置。</p>
</blockquote>
<h2 id="为什么要配置https域名证书"><a href="#为什么要配置https域名证书" class="headerlink" title="为什么要配置https域名证书"></a>为什么要配置https域名证书</h2><blockquote>
<p>符合苹果app审核的必要条件</p>
</blockquote>
<blockquote>
<p>同理安卓或微信小程序审核也是要符合这个条件的</p>
</blockquote>

      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2021/01/12/CentOS7配置JAVA环境变量/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2021/01/12/CentOS7配置JAVA环境变量/" itemprop="url">CentOS7配置JAVA环境变量</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2021-01-12T10:24:00+08:00">2021-01-12 10:24:00</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <blockquote>
<p>在/etc/profile.d/路径下新建一个文件，名为java.sh</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile.d/java.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在文件中配置如下环境配置内容</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_251</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br></pre></td></tr></table></figure>

<blockquote>
<p>保存并关闭文件，执行以下命令使之可运行</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/profile.d/java.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后，执行以下命令来永久设置环境变量</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile.d/java.sh</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
      <div class="post-tags">
        
        <a class="post-tag button" href="/tags/环境变量/" rel="tag"><i class="fas fa-tags"></i>环境变量</a>
        
      </div>
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2020/12/14/Idea以debug方式启动时报错/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2020/12/14/Idea以debug方式启动时报错/" itemprop="url">Idea以debug方式启动时报错 Command line is too long</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2020-12-14T15:44:04+08:00">2020-12-14 15:44:04</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="错误描述信息"><a href="#错误描述信息" class="headerlink" title="错误描述信息"></a>错误描述信息</h1><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error running &apos;SaleAdminApplication&apos;: Command line is too long. Shorten command line for SaleAdminApplication or also for Spring Boot default configuration.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个错误信息在run运行方式不出现，在debug的运行方式才会出现</p>
</blockquote>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><blockquote>
<p>使用编辑器打开工作目录下的文件 —&gt; .idea\workspace.xml</p>
</blockquote>
<blockquote>
<p>找到标签</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component name=&quot;PropertiesComponent&quot;&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>标签中添加内容</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=&quot;dynamic.classpath&quot; value=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2020/12/11/mysql表备份办法/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2020/12/11/mysql表备份办法/" itemprop="url">mysql表备份办法</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2020-12-11T23:15:08+08:00">2020-12-11 23:15:08</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="复制表结构导入旧表数据"><a href="#复制表结构导入旧表数据" class="headerlink" title="复制表结构导入旧表数据"></a>复制表结构导入旧表数据</h1><h2 id="新建新表与旧表表结构相同"><a href="#新建新表与旧表表结构相同" class="headerlink" title="新建新表与旧表表结构相同"></a>新建新表与旧表表结构相同</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table new_table like old_table;</span><br></pre></td></tr></table></figure>

<h2 id="将旧表数据导入新表"><a href="#将旧表数据导入新表" class="headerlink" title="将旧表数据导入新表"></a>将旧表数据导入新表</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into new_table select * from old_table;</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2020/12/04/git中tag标签的使用/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2020/12/04/git中tag标签的使用/" itemprop="url">git中tag标签的使用</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2020-12-04T16:08:47+08:00">2020-12-04 16:08:47</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="什么是tag"><a href="#什么是tag" class="headerlink" title="什么是tag"></a>什么是tag</h1><blockquote>
<p>tag是git版本库的一个标记，指向某个commit的指针。</p>
</blockquote>
<blockquote>
<p>tag主要用于发布版本的管理，一个版本发布之后，我们可以为git打上 v.1.0.1 v.1.0.2 …这样的标签。</p>
</blockquote>
<blockquote>
<p>tag感觉跟branch有点相似，但是本质上和分工上是不同的：</p>
</blockquote>
<blockquote>
<p>tag 对应某次commit, 是一个点，是不可移动的。</p>
</blockquote>
<blockquote>
<p>branch 对应一系列commit，是很多点连成的一根线，有一个HEAD 指针，是可以依靠 HEAD 指针移动的。</p>
</blockquote>
<h1 id="创建tag"><a href="#创建tag" class="headerlink" title="创建tag"></a>创建tag</h1><h2 id="创建本地tag"><a href="#创建本地tag" class="headerlink" title="创建本地tag"></a>创建本地tag</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag &lt;tagName&gt;</span><br></pre></td></tr></table></figure>

<h2 id="创建tag指定message"><a href="#创建tag指定message" class="headerlink" title="创建tag指定message"></a>创建tag指定message</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a &lt;tagname&gt; -m &quot;message&quot;</span><br></pre></td></tr></table></figure>

<h2 id="指定某个commit-id创建tag"><a href="#指定某个commit-id创建tag" class="headerlink" title="指定某个commit id创建tag"></a>指定某个commit id创建tag</h2><p><strong>先查看历史的comitId</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty=oneline</span><br></pre></td></tr></table></figure>

<p><strong>指定某个commitId创建tag</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a &lt;tagName&gt; &lt;commitId&gt;</span><br></pre></td></tr></table></figure>

<h2 id="将tag推送到远程仓库"><a href="#将tag推送到远程仓库" class="headerlink" title="将tag推送到远程仓库"></a>将tag推送到远程仓库</h2><h3 id="指定tag推送到远端"><a href="#指定tag推送到远端" class="headerlink" title="指定tag推送到远端"></a>指定tag推送到远端</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;tagName&gt;</span><br></pre></td></tr></table></figure>

<h3 id="推送所有tag到远端"><a href="#推送所有tag到远端" class="headerlink" title="推送所有tag到远端"></a>推送所有tag到远端</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>

<h1 id="查看tag"><a href="#查看tag" class="headerlink" title="查看tag"></a>查看tag</h1><p><strong>查看本地某个 tag 的详细信息</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show &lt;tagName&gt;</span><br></pre></td></tr></table></figure>

<p><strong>查看本地所有 tag</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag 或者 git tag -l</span><br></pre></td></tr></table></figure>

<p><strong>查看远程所有 tag</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-remote --tags origin</span><br></pre></td></tr></table></figure>

<h1 id="删除标签"><a href="#删除标签" class="headerlink" title="删除标签"></a>删除标签</h1><h2 id="本地标签删除"><a href="#本地标签删除" class="headerlink" title="本地标签删除"></a>本地标签删除</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d &lt;tagName&gt;</span><br></pre></td></tr></table></figure>

<h2 id="远程-tag-的删除"><a href="#远程-tag-的删除" class="headerlink" title="远程 tag 的删除"></a>远程 tag 的删除</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :&lt;tagName&gt;</span><br></pre></td></tr></table></figure>

<h1 id="检出标签"><a href="#检出标签" class="headerlink" title="检出标签"></a>检出标签</h1><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branchName&gt; &lt;tagName&gt;</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://developertanliyuan.github.io/2020/11/24/golang学习笔记/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Tan Liyuan">
        <meta itemprop="description" content="一个热爱生活的小男孩">
        <meta itemprop="image" content="/images/tanliyuan_katong.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="DeveloperTanliyuan">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link post-title-link-external" href="/2020/11/24/golang学习笔记/" itemprop="url">golang学习笔记</a>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2020-11-24T11:00:00+08:00">2020-11-24 11:00:00</time></span>
        </span>
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      
      <h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="变量定义"><a href="#变量定义" class="headerlink" title="变量定义"></a>变量定义</h2><blockquote>
<p><strong>使用var关键字</strong></p>
<blockquote>
<p>var a,b,c bool<br>var s1,s2 string = “hello”,”world”<br>可以放在函数内，或直接放在包内<br>使用var()集中定义变量</p>
</blockquote>
</blockquote>
<blockquote>
<p><strong>使用:=定义变量</strong></p>
<blockquote>
<p>a,b,i,s1,s2 := true,false,3,”hello”,”world”，让编译器自动决定编译类型<br>只能在函数内使用</p>
</blockquote>
</blockquote>
<blockquote>
<p><strong>变量定义注意事项</strong></p>
<blockquote>
<p>定义过得变量一定要使用，否则编译器会报错<br>字符串类型的变量初始值是空字符串（不像java为null）<br>变量定义的时候赋值可以不用定义数据类型，编译器会进行类型推断，甚至在同一行代码定义不同类型的变量都是可以的<br>在函数外面定义变量不能使用:=来定义变量，只能使用var关键字进行变量定义<br>函数外面定义变量作用域在包内部，没有全局变量的说法</p>
</blockquote>
</blockquote>
<h2 id="内建变量类型"><a href="#内建变量类型" class="headerlink" title="内建变量类型"></a>内建变量类型</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><blockquote>
<p><strong>bool</strong>:布尔</p>
</blockquote>
<blockquote>
<p><strong>string</strong>字符串</p>
</blockquote>
<blockquote>
<p><strong>int</strong>整形</p>
<blockquote>
<p><strong>(u)int</strong>  根据操作系统位数决定长度(32位系统长度(u)int32/64位系统(u)int64)<br><strong>(u)int8</strong><br><strong>(u)int16</strong><br><strong>(u)int32</strong><br><strong>(u)int64</strong></p>
</blockquote>
</blockquote>
<blockquote>
<p><strong>uinttpr</strong>指针</p>
</blockquote>
<blockquote>
<p><strong>byte</strong>字节</p>
</blockquote>
<blockquote>
<p><strong>rune</strong>字符(32bit)</p>
</blockquote>
<blockquote>
<p><strong>float</strong>(浮点)</p>
<blockquote>
<p><strong>float32</strong><br><strong>float64</strong></p>
</blockquote>
</blockquote>
<blockquote>
<p><strong>complex</strong>(复数)</p>
<blockquote>
<p><strong>complex64</strong>  实部和虚部各32位浮点数<br><strong>complex128</strong>  实部和虚部各64位浮点数</p>
</blockquote>
</blockquote>
<h3 id="复数回顾"><a href="#复数回顾" class="headerlink" title="复数回顾"></a>复数回顾</h3><p><strong>什么是复数</strong>:复数是形如 a ＋ b i的数.式中a,b 为 实数,i是一个满足<strong>i^2 ＝－1</strong>的数,因为任何实数的平方不等于－1,所以i不是实数,而是实数以外的新的数.</p>
<p><strong>|3+4i| = 5 ？到底是怎么算的？有知道的可以告诉我一下，我不会算😢</strong>开始还以为这个公式有问题，结果程序跑出来的结果就是这么多😫</p>
<p><img src="/images/img_5.png" alt="复数"></p>
<p><strong>i^0 = 1</strong></p>
<p><strong>i^1 = i</strong></p>
<p><strong>i^2 = -1</strong></p>
<p><strong>i^3 = -i</strong></p>
<p><strong>i^4 = 1</strong></p>
<p><strong>i^5 = i</strong></p>
<p><strong>i^6 = -1</strong></p>
<p><strong>我们发现</strong>每增加一个次方就逆时针旋转90度</p>
<p><img src="/images/img_6.png" alt="欧拉公式的由来"></p>
<p><img src="/images/img_7.png" alt="最美公式-欧拉公式"></p>
<h2 id="常量与枚举"><a href="#常量与枚举" class="headerlink" title="常量与枚举"></a>常量与枚举</h2><h3 id="常量定义使用const关键字定义"><a href="#常量定义使用const关键字定义" class="headerlink" title="常量定义使用const关键字定义"></a>常量定义使用const关键字定义</h3><blockquote>
<p>常量可以规定数据类型，也可以让编译器自主推断类型</p>
</blockquote>
<blockquote>
<p>常量也可以定义在const()里面表示定义一组常量</p>
</blockquote>
<blockquote>
<p>go语言的常量名称定义一般不大写，大写F代表public</p>
</blockquote>
<h3 id="枚举类型使用const-定义"><a href="#枚举类型使用const-定义" class="headerlink" title="枚举类型使用const()定义"></a>枚举类型使用const()定义</h3><blockquote>
<p>go语言中没有专门的枚举类型，所以我们以常量组作为枚举类型</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const (</span><br><span class="line">	zero = 0</span><br><span class="line">	one = 1</span><br><span class="line">	two = 2</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>go语言提供了iota关键字是枚举值的自增表达式,使用_下划线跳过</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const (</span><br><span class="line">	cpp = iota</span><br><span class="line">	_</span><br><span class="line">	python</span><br><span class="line">	golang</span><br><span class="line">	javascript</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>以上枚举常量的值为cpp:0/_:1/python:2/golang:3/javascript:4</p>
<blockquote>
<p>还能以iota关键之定义磁盘容量表达式如下</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const (</span><br><span class="line">	b 1 &lt;&lt; (10 * iota)</span><br><span class="line">	kb</span><br><span class="line">	mb</span><br><span class="line">	gb</span><br><span class="line">	tb</span><br><span class="line">	pb</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><h3 id="if条件语句"><a href="#if条件语句" class="headerlink" title="if条件语句"></a>if条件语句</h3><blockquote>
<p><strong>示例</strong>：读取文件</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	const filename = &quot;abc.txt&quot;</span><br><span class="line">	//go语言的函数可以返回多个值</span><br><span class="line">	file, err := ioutil.ReadFile(filename)</span><br><span class="line">	//错误不为空打印错误</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		//没有错误打印文本文件内容</span><br><span class="line">		fmt.Printf(&quot;%s\n\n&quot;, file)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：go语言的if语句可以像其它语言的for语句的写法，先初始化赋值（定义变量），再进行条件判断,使用分号分隔，作用域在if以内，写法如下</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">	const filename = &quot;abc.txt&quot;</span><br><span class="line">	if file, err := ioutil.ReadFile(filename); err != nil &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		fmt.Printf(&quot;%s\n\n&quot;, file)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="switch条件语句"><a href="#switch条件语句" class="headerlink" title="switch条件语句"></a>switch条件语句</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">func eval(a int, b int, op string) int &#123;</span><br><span class="line">	var result int</span><br><span class="line">	switch op &#123;</span><br><span class="line">	case &quot;+&quot;:</span><br><span class="line">		result = a+b</span><br><span class="line">	case &quot;-&quot;:</span><br><span class="line">		result = a-b</span><br><span class="line">	case &quot;*&quot;:</span><br><span class="line">		result = a*b</span><br><span class="line">	case &quot;/&quot;:</span><br><span class="line">		result = a/b</span><br><span class="line">	default:</span><br><span class="line">		panic(&quot;unsupported operator&quot; + op)</span><br><span class="line">	&#125;</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>看看这段</strong></p>
<blockquote>
<p>switch代码块中的case会自动break，如果不适用break使用fallthrough，也就是其它预压的case穿透。</p>
</blockquote>
<blockquote>
<p>panic是go语言中的报错，报错会让程序停下来。</p>
</blockquote>
<p><strong>switch里面如果没有表达式也可以将条件放到case语句里面，代码如下：</strong></p>
<figure class="hljs highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">grade</span><span class="params">(score <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	g := <span class="string">""</span></span><br><span class="line">	<span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> score &lt; <span class="number">60</span>:</span><br><span class="line">		g = <span class="string">"F"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt; <span class="number">80</span>:</span><br><span class="line">		g = <span class="string">"C"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt; <span class="number">90</span>:</span><br><span class="line">		g = <span class="string">"B"</span></span><br><span class="line">	<span class="keyword">case</span> score &lt;= <span class="number">100</span>:</span><br><span class="line">		g = <span class="string">"A"</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"Wrong score:%d"</span>,score))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><p><strong>一个简单的for循环</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">func loopdemo() &#123;</span><br><span class="line">	sum := 1</span><br><span class="line">	for i := 0; i &lt; 100; i++ &#123;</span><br><span class="line">		sum+=1</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>for语句的条件里不需要括号</p>
</blockquote>
<blockquote>
<p>for的条件里面可以省略初始条件，结束条件，递增表达式</p>
</blockquote>
<p><strong>没有初始化条件的写法</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//将数字转换为2进制字符</span><br><span class="line">func convertToBin(number int) string &#123;</span><br><span class="line">	result := &quot;&quot;</span><br><span class="line">	for ; number &gt; 0; number /= 2 &#123;</span><br><span class="line">		lsb := number % 2</span><br><span class="line">		result = strconv.Itoa(lsb) + result</span><br><span class="line">	&#125;</span><br><span class="line">	return result</span><br><span class="line">&#125;</span><br><span class="line">//go语言对换行有所讲究，需要加上逗号</span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Println(</span><br><span class="line">		convertToBin(2),</span><br><span class="line">		convertToBin(3),</span><br><span class="line">		convertToBin(4),</span><br><span class="line">	)</span><br><span class="line">	//打印结果为10 11 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>初始化条件及递增表达式同时省略（相当于while，但是go语言中没有while）</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func printFile(filename string) &#123;</span><br><span class="line">	file, err := os.Open(filename)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	scanner := bufio.NewScanner(file)</span><br><span class="line">	for scanner.Scan() &#123;</span><br><span class="line">		fmt.Println(scanner.Text())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	printFile(&quot;abc.txt&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>死循环写法(并发编程相互通信会用到死循环)</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func forever() &#123;</span><br><span class="line">	for true &#123;</span><br><span class="line">		fmt.Println(&quot;死循环&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	forever()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><blockquote>
<p>函数可以返回多个值</p>
</blockquote>
<blockquote>
<p>函数返回多个值时可以起名字（仅限于非常简单的函数，但对于调用者可以随便起名）</p>
</blockquote>
<blockquote>
<p>go语言函数是函数式编程语言，函数是一等公民，函数里面的参数、返回值、函数体都可以有函数</p>
</blockquote>
<blockquote>
<p>go语言没有花哨的lambda表达式，是需要将匿名函数写出即可</p>
</blockquote>
<blockquote>
<p>go语言没有默认参数，也没有方法重载</p>
</blockquote>
<blockquote>
<p>go语言函数有可变参数列表</p>
</blockquote>
<h3 id="使用函数式编程实现3的4次方"><a href="#使用函数式编程实现3的4次方" class="headerlink" title="使用函数式编程实现3的4次方"></a>使用函数式编程实现3的4次方</h3><p><strong>代码如下</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//重新定义pow函数接收int类型</span><br><span class="line">func pow(a, b int) int &#123;</span><br><span class="line">	return int(math.Pow(float64(a), float64(b)))</span><br><span class="line">&#125;</span><br><span class="line">//op定义了调用方传递的函数</span><br><span class="line">func apply(op func(int, int) int, a int, b int) (result int) &#123;</span><br><span class="line">	//反射获取到传递过来的函数的指针</span><br><span class="line">	pointer := reflect.ValueOf(op).Pointer()</span><br><span class="line">	//通过指针获取函数名称</span><br><span class="line">	name := runtime.FuncForPC(pointer).Name()</span><br><span class="line">	//打印传递的函数名称及参数</span><br><span class="line">	fmt.Printf(&quot;calling function is %s with args (%d,%d) \n&quot;, name, a, b)</span><br><span class="line">	//返回值由传入的函数处理后的结果决定</span><br><span class="line">	return op(a, b)</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">	//计算3的4次方等于81,传的的函数式操作为pow,a的b次方</span><br><span class="line">	fmt.Println(apply(pow, 3, 4))</span><br><span class="line">	//也可以使用匿名函数的方式，计算2的3次方</span><br><span class="line">	fmt.Println(apply(</span><br><span class="line">		func(a int, b int) int &#123;</span><br><span class="line">			return int(math.Pow(float64(a), float64(b)))</span><br><span class="line">		&#125;, 2, 3))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行结果</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calling function is main.pow with args (3,4) </span><br><span class="line">81</span><br><span class="line">calling function is main.main.func1 with args (2,3) </span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h3 id="函数的可变参示例"><a href="#函数的可变参示例" class="headerlink" title="函数的可变参示例"></a>函数的可变参示例</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func sum(numbers ...int) int &#123;</span><br><span class="line">	sum := 0</span><br><span class="line">	for i := range numbers &#123;</span><br><span class="line">		sum += numbers[i]</span><br><span class="line">	&#125;</span><br><span class="line">	return sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><p><strong>先看一段代码</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func pointer() &#123;</span><br><span class="line">	//定义变量a赋值为2</span><br><span class="line">	var a int = 2</span><br><span class="line">	//定义一个指针pa，类型为*int（指针型int），指向变量a的地址值</span><br><span class="line">	var pa *int = &amp;a</span><br><span class="line">	//将指针*pa指向的地址值赋值为3,也就是将变量a赋值为3</span><br><span class="line">	*pa = 3</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	//打印结果为3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>go语言的指针不能进行运算</p>
</blockquote>
<blockquote>
<p>go语言只有值传递一种方式（值传递会copy一份数据进行操作/引用传递会操作传递的值）</p>
</blockquote>
<blockquote>
<p>go语言通过指针传递能打到引用传递的效果</p>
</blockquote>
<blockquote>
<p>自定义类型需要考虑该类型是需要作为指针使用还是作为值来使用</p>
</blockquote>
<h3 id="使用指针对变量进行操作"><a href="#使用指针对变量进行操作" class="headerlink" title="使用指针对变量进行操作"></a>使用指针对变量进行操作</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func swap(a *int, b *int) &#123;</span><br><span class="line">	*a, *b = *b, *a</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">	a := 3</span><br><span class="line">	b := 4</span><br><span class="line">	//使用指针对变量进行操作</span><br><span class="line">	swap(&amp;a, &amp;b)</span><br><span class="line">	fmt.Println(a,b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不使用指针将操作后的结果返回或许更好"><a href="#不使用指针将操作后的结果返回或许更好" class="headerlink" title="不使用指针将操作后的结果返回或许更好"></a>不使用指针将操作后的结果返回或许更好</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func swap(a int, b int) (resa int, resb int) &#123;</span><br><span class="line">	return b, a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	a := 3</span><br><span class="line">	b := 4</span><br><span class="line">	//使用指针对变量进行操作</span><br><span class="line">	a, b = swap(a, b)</span><br><span class="line">	fmt.Println(a,b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="内建容器"><a href="#内建容器" class="headerlink" title="内建容器"></a>内建容器</h1><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><blockquote>
<p><strong>数组是值类型</strong>，在函数中执行的时候进行拷贝一份再处理</p>
</blockquote>
<blockquote>
<p>go语言中认为[3]int类型与[5]int认为是不同的类型，在调用的时候数组长度不一致go会认为是不同类型</p>
</blockquote>
<blockquote>
<p>go语言中我们一般情况下不使用数组，也不使用数组的指针，我们使用切片Slice</p>
</blockquote>
<p><strong>数组的定义方法</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//定义容量为5元素类型为int的数组(元素初始值为0)</span><br><span class="line">var array1 [5]int</span><br><span class="line">//定义容量为3元素类型为int的数组(指定元素初始值)</span><br><span class="line">array2 := [3]int&#123;1,2,3&#125;</span><br><span class="line">//容量为编译器来确定类型为int的数组</span><br><span class="line">array3 := [...]int&#123;2,4,6,8,10&#125;</span><br><span class="line">//定义4行5列的int类型二维数组(元素初始值为0)</span><br><span class="line">var grid [4][5]int</span><br></pre></td></tr></table></figure>

<p><strong>普通for循环遍历数组</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">func foreachArr() &#123;</span><br><span class="line">	arr := [...]int&#123;2,4,6,8,10&#125;</span><br><span class="line">	for i := 0; i &lt; len(arr); i++ &#123;</span><br><span class="line">		fmt.Println(arr[i])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>for i := range遍历数组</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func foreachArr() &#123;</span><br><span class="line">	arr := [...]int&#123;2,4,6,8,10&#125;</span><br><span class="line">	//这里的i取到的是arr的索引</span><br><span class="line">	for i := range arr&#123;</span><br><span class="line">		fmt.Println(arr[i])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>for i := range遍历数组同时取索引和值</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func foreachArr() &#123;</span><br><span class="line">	arr := [...]int&#123;2,4,6,8,10&#125;</span><br><span class="line">	//这里的i取到的是arr的索引，v取到的是值</span><br><span class="line">	for i,v := range arr&#123;</span><br><span class="line">		fmt.Println(i,v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>for i := range遍历数组只获取值</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func foreachArr() &#123;</span><br><span class="line">	arr := [...]int&#123;2,4,6,8,10&#125;</span><br><span class="line">	//这里的索引以下标_替换代表不取索引，v取到的是值（任何地方都可以使用下标_省略变量）</span><br><span class="line">	for _,v := range arr&#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="切片-Slice"><a href="#切片-Slice" class="headerlink" title="切片(Slice)"></a>切片(Slice)</h2><p><strong>我们先看一段代码，看看什么是切片</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr := [...]int&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line">s := arr[2:6]</span><br><span class="line">//这里的s就是切片,一个左闭右开的区(数学里面的闭区间是取等的)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Slice其实是数组的一个视图</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr[2:6] = [2 3 4 5]</span><br><span class="line">arr[:6] = [0 1 2 3 4 5]</span><br><span class="line">arr[2:] = [2 3 4 5 6 7]</span><br><span class="line">arr[:] = [0 1 2 3 4 5 6 7]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Slice本身没有数据，是对底层array的一个view</p>
</blockquote>
<h3 id="Reslice"><a href="#Reslice" class="headerlink" title="Reslice"></a>Reslice</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr := [...]int&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line">s2 := arr[:]</span><br><span class="line">//[0 1 2 3 4 5 6 7]</span><br><span class="line">s2 = s2[:5]</span><br><span class="line">//[0 1 2 3 4]</span><br><span class="line">s2 = s2[2:]</span><br><span class="line">//[2 3 4]</span><br></pre></td></tr></table></figure>

<h3 id="slice的扩展"><a href="#slice的扩展" class="headerlink" title="slice的扩展"></a>slice的扩展</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arr := [...]int&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line">//上面是元素数据</span><br><span class="line">s1 := arr[2:6]</span><br><span class="line">//[2 3 4 5]</span><br><span class="line">//fmt.Pringln(s1[4])</span><br><span class="line">//上面这行注释的代码会报索引越界异常，用下面的slice(s2)可以结局这个问题，golang的slice有cap的概念</span><br><span class="line">s2 := s1[3:5]</span><br><span class="line">//[5 6]</span><br></pre></td></tr></table></figure>

<p><strong>上面这一块的代码图解如下</strong></p>
<p><img src="/images/img_8.png" alt="slice扩展"></p>
<h3 id="slice的实现"><a href="#slice的实现" class="headerlink" title="slice的实现"></a>slice的实现</h3><p><img src="/images/img_9.png" alt="slice的实现"></p>
<blockquote>
<p>slice底层有一个array</p>
</blockquote>
<blockquote>
<p>ptr指向了slice开头的元素</p>
</blockquote>
<blockquote>
<p>len指向了slice的长度，使用slice[n]只能取len长度里面的值，超过长度值会报索引越界</p>
</blockquote>
<blockquote>
<p>cap代表了从ptr开始整个数组的长度，扩展的时候只要不超过cap的长度就可以</p>
</blockquote>
<blockquote>
<p>slice可以向后扩展，但是不可以往前扩展，向后扩展不可以超过cap的长度</p>
</blockquote>
<blockquote>
<p>len(slice)可以取到这个slice的长度，cap(slice)可以取到这个slice的cap长度</p>
</blockquote>
<h2 id="切片-slice-的操作"><a href="#切片-slice-的操作" class="headerlink" title="切片(slice)的操作"></a>切片(slice)的操作</h2><h3 id="slice的append操作"><a href="#slice的append操作" class="headerlink" title="slice的append操作"></a>slice的append操作</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arr := [...]int&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line">//上面是元素数据</span><br><span class="line">s1 := arr[2:6]</span><br><span class="line">//s1---&gt;[2 3 4 5]</span><br><span class="line">//fmt.Pringln(s1[4])</span><br><span class="line">//上面这行注释的代码会报索引越界异常，用下面的slice(s2)可以结局这个问题，golang的slice有cap的概念</span><br><span class="line">s2 := s1[3:5]</span><br><span class="line">//s2---&gt;[5 6]</span><br><span class="line">s3 := appent(s2,10)</span><br><span class="line">//s3---&gt;[5 6 10]</span><br><span class="line">s4 := appent(s3,11)</span><br><span class="line">//s4---&gt;[5 6 10 11]</span><br><span class="line">s5 := appent(s4,12)</span><br><span class="line">//s5---&gt;[5 6 10 11 12]</span><br><span class="line"></span><br><span class="line">//arr最终的值为[0 1 2 3 4 5 6 10],arr的长度并没有发生变化，而s4及s5是对被扩展的数组的一个view，我们拿不到扩展的数组，s3 appent过后但是他并没有超过arr长度，所以对底层arr相应索引位置的数据进行了修改</span><br></pre></td></tr></table></figure>

<blockquote>
<p>添加元素时如果超过cap的长度，系统会重新分配更大的底层数组作为新slice的view</p>
</blockquote>
<blockquote>
<p>如果原来的数组有用系统会保留，如果没用会被go的垃圾回收机制给回收掉</p>
</blockquote>
<blockquote>
<p>由于值传递的关系必须接受appent的返回值 s = append(s,val)</p>
</blockquote>
<h3 id="slice的其它操作"><a href="#slice的其它操作" class="headerlink" title="slice的其它操作"></a>slice的其它操作</h3><h4 id="slice的创建"><a href="#slice的创建" class="headerlink" title="slice的创建"></a>slice的创建</h4><p><strong>定义一个空的slice长度为0</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var s []int</span><br></pre></td></tr></table></figure>

<p><strong>定义指定元素内容的slice</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s1 := []int&#123;2,4,6,8&#125;</span><br></pre></td></tr></table></figure>

<p><strong>内建函数定义len为16的slice</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s2 := make([]int,16)</span><br></pre></td></tr></table></figure>

<p><strong>内建函数定义len为10 cap为32 的slice</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s3 := make([]int,10,32)</span><br></pre></td></tr></table></figure>

<h4 id="slice的copy及元素remove操作"><a href="#slice的copy及元素remove操作" class="headerlink" title="slice的copy及元素remove操作"></a>slice的copy及元素remove操作</h4><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s1 := []int&#123;2,4,6,8&#125;</span><br><span class="line">//s1---&gt;[2 4 6 8]</span><br><span class="line">s2 := make([]int,16)</span><br><span class="line">//s2---&gt;[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</span><br><span class="line">copy(s2,s1)</span><br><span class="line">//s2---&gt;[2 4 6 8 0 0 0 0 0 0 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>

<p><strong>如果我们想要把s2中的元素8删掉怎么操作呢</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//s2---&gt;[2 4 6 8 0 0 0 0 0 0 0 0 0 0 0 0]</span><br><span class="line">s2 = append(s2[:3],s2[4:]...)//s2所在的参数列表是一个可变参，如果需要将s2索引4右面的所有元素都送个它需要加上...的语法</span><br><span class="line">//s2---&gt;[2 4 6 0 0 0 0 0 0 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>

<p><strong>去掉s2的首尾操作</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//s2---&gt;[2 4 6 0 0 0 0 0 0 0 0 0 0 0 0]</span><br><span class="line">//获取首元素的值，可以用于打印</span><br><span class="line">front := s2[0]</span><br><span class="line">//获取尾元素，可以用于打印</span><br><span class="line">tail := s2[len(s2)-1]</span><br><span class="line">//剔除首位操作</span><br><span class="line">s2 := s2[1:]</span><br><span class="line">s2 := s2[:len(s2)-1]</span><br><span class="line">//s2---&gt;[4 6 0 0 0 0 0 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>

<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><h3 id="Map的创建"><a href="#Map的创建" class="headerlink" title="Map的创建"></a>Map的创建</h3><blockquote>
<p>map[Key]Value 创建单层Key/Value类型的Map</p>
</blockquote>
<blockquote>
<p>map[Key1]map[Key2]Value 创建复合多层级Map</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mapDemo := map[string]string&#123;</span><br><span class="line">	&quot;name&quot;:    &quot;anakin&quot;,</span><br><span class="line">	&quot;course&quot;:  &quot;java&quot;,</span><br><span class="line">	&quot;site&quot;:    &quot;imooc&quot;,</span><br><span class="line">	&quot;quality&quot;: &quot;notbad&quot;,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(mapDemo)</span><br></pre></td></tr></table></figure>

<p><strong>空map的创建</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//使用make</span><br><span class="line">m1 := make(map[string]int)</span><br><span class="line">//m1---&gt;map[] (m1 == empty)</span><br><span class="line">//或者使用</span><br><span class="line">var m2 map[string]int</span><br><span class="line">//m2---&gt;map[] (m2 == nil)</span><br><span class="line"></span><br><span class="line">//go语言中的nil及empty是可以参与运算的，跟其它语言有所区别，值是nil也可以很安全的使用</span><br></pre></td></tr></table></figure>

<h3 id="Map的迭代"><a href="#Map的迭代" class="headerlink" title="Map的迭代"></a>Map的迭代</h3><p><strong>使用range对map进行迭代</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func mapIterate() &#123;</span><br><span class="line">	mapDemo := map[string]string&#123;</span><br><span class="line">		&quot;name&quot;:    &quot;anakin&quot;,</span><br><span class="line">		&quot;course&quot;:  &quot;java&quot;,</span><br><span class="line">		&quot;site&quot;:    &quot;imooc&quot;,</span><br><span class="line">		&quot;quality&quot;: &quot;notbad&quot;,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(mapDemo)</span><br><span class="line">	for k,v := range mapDemo&#123;</span><br><span class="line">		fmt.Println(k,v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//map打印出来的值我们发现map中的元素是无序的</span><br></pre></td></tr></table></figure>

<h3 id="map获取指定元素"><a href="#map获取指定元素" class="headerlink" title="map获取指定元素"></a>map获取指定元素</h3><p><strong>通过key获取map中value的值</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func mapDemo() &#123;</span><br><span class="line">	mapDemo := map[string]string&#123;</span><br><span class="line">		&quot;name&quot;:    &quot;anakin&quot;,</span><br><span class="line">		&quot;course&quot;:  &quot;java&quot;,</span><br><span class="line">		&quot;site&quot;:    &quot;imooc&quot;,</span><br><span class="line">		&quot;quality&quot;: &quot;notbad&quot;,</span><br><span class="line">	&#125;</span><br><span class="line">	courseName := mapDemo[&quot;course&quot;]</span><br><span class="line">	fmt.Println(courseName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果map中没有这个key的话获取map的值不会报错，他是一个空串，Println他会打印一个空行</p>
</blockquote>
<h3 id="判断map中的某个元素是否存在"><a href="#判断map中的某个元素是否存在" class="headerlink" title="判断map中的某个元素是否存在"></a>判断map中的某个元素是否存在</h3><p><strong>判断元素在map中是否存在，存在则打印，不存在不打印</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func mapDemo() &#123;</span><br><span class="line">	mapDemo := map[string]string&#123;</span><br><span class="line">		&quot;name&quot;:    &quot;anakin&quot;,</span><br><span class="line">		&quot;course&quot;:  &quot;java&quot;,</span><br><span class="line">		&quot;site&quot;:    &quot;imooc&quot;,</span><br><span class="line">		&quot;quality&quot;: &quot;notbad&quot;,</span><br><span class="line">	&#125;</span><br><span class="line">	if courseName, ok := mapDemo[&quot;course&quot;]; ok &#123;</span><br><span class="line">		fmt.Println(courseName)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		fmt.Println(&quot;key does not exist&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="map删除指定元素"><a href="#map删除指定元素" class="headerlink" title="map删除指定元素"></a>map删除指定元素</h3><p><strong>删除map中的指定key</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func mapDemo() &#123;</span><br><span class="line">	mapDemo := map[string]string&#123;</span><br><span class="line">		&quot;name&quot;:    &quot;anakin&quot;,</span><br><span class="line">		&quot;course&quot;:  &quot;java&quot;,</span><br><span class="line">		&quot;site&quot;:    &quot;imooc&quot;,</span><br><span class="line">		&quot;quality&quot;: &quot;notbad&quot;,</span><br><span class="line">	&#125;</span><br><span class="line">	delete(mapDemo,&quot;name&quot;)</span><br><span class="line">	//删除key为name的元素，后面的key does not exist提示将会被打印</span><br><span class="line">	if courseName, ok := mapDemo[&quot;name&quot;]; ok &#123;</span><br><span class="line">		fmt.Println(courseName)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		fmt.Println(&quot;key does not exist&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="什么样的数据类型才能作为map的key呢"><a href="#什么样的数据类型才能作为map的key呢" class="headerlink" title="什么样的数据类型才能作为map的key呢"></a>什么样的数据类型才能作为map的key呢</h3><blockquote>
<p>map使用哈希表，必须可以比较相等</p>
</blockquote>
<blockquote>
<p>除了slice，map，function的内建类型都可以作为key</p>
</blockquote>
<blockquote>
<p>Struct(自建)类型不包含上述字段也可以作为key</p>
</blockquote>
<blockquote>
<p>go在编译器会对上述条件进行检查</p>
</blockquote>
<h3 id="map实现leetCode算法3-无重复字符的最长子串"><a href="#map实现leetCode算法3-无重复字符的最长子串" class="headerlink" title="map实现leetCode算法3.无重复字符的最长子串"></a>map实现leetCode算法3.无重复字符的最长子串</h3><p><strong>英文版</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">func lengthOfLongestSubstring(s string) int &#123;</span><br><span class="line">    //记录每个字母最后出现的位置</span><br><span class="line">    lastOccurred := make(map[byte]int)</span><br><span class="line">    start := 0</span><br><span class="line">    maxLenght := 0</span><br><span class="line">    for i,ch := range []byte(s) &#123;</span><br><span class="line">        //有可能不存在这个map获取出来的值是0,而0又是一个合法的下标，所以要判断这个key是否存在</span><br><span class="line">        if lastI,ok := lastOccurred[ch] ; ok &amp;&amp; lastI &gt;= start &#123;</span><br><span class="line">            start = lastOccurred[ch] +1</span><br><span class="line">        &#125;</span><br><span class="line">        if i - start +1 &gt; maxLenght &#123;</span><br><span class="line">            maxLenght = i - start + 1</span><br><span class="line">        &#125;</span><br><span class="line">        lastOccurred[ch] = i</span><br><span class="line">    &#125;</span><br><span class="line">    return maxLenght</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>国际版</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">func lengthOfLongestSubstring(s string) int &#123;</span><br><span class="line">    //记录每个字母最后出现的位置</span><br><span class="line">    lastOccurred := make(map[rune]int)</span><br><span class="line">    start := 0</span><br><span class="line">    maxLenght := 0</span><br><span class="line">    for i,ch := range []rune(s) &#123;</span><br><span class="line">        //有可能不存在这个map获取出来的值是0,而0又是一个合法的下标，所以要判断这个key是否存在</span><br><span class="line">        if lastI,ok := lastOccurred[ch] ; ok &amp;&amp; lastI &gt;= start &#123;</span><br><span class="line">            start = lastOccurred[ch] +1</span><br><span class="line">        &#125;</span><br><span class="line">        if i - start +1 &gt; maxLenght &#123;</span><br><span class="line">            maxLenght = i - start + 1</span><br><span class="line">        &#125;</span><br><span class="line">        lastOccurred[ch] = i</span><br><span class="line">    &#125;</span><br><span class="line">    return maxLenght</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><blockquote>
<p>go语言仅支持封装，不支持继承和多态</p>
</blockquote>
<blockquote>
<p>go语言没有class，只有struct</p>
</blockquote>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><h3 id="结构体定义"><a href="#结构体定义" class="headerlink" title="结构体定义"></a>结构体定义</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//定义结构体</span><br><span class="line">type TreeNode struct &#123;</span><br><span class="line">	value int</span><br><span class="line">	left,right *TreeNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//对结构体数据进行处理</span><br><span class="line">func main() &#123;</span><br><span class="line">	node1 := TreeNode&#123;value: 3&#125;</span><br><span class="line">	left := TreeNode&#123;value: 1&#125;</span><br><span class="line">	right := TreeNode&#123;value: 2&#125;</span><br><span class="line">	node1.left = &amp;left</span><br><span class="line">	node1.right = &amp;right</span><br><span class="line">	fmt.Println(node1)</span><br><span class="line">&#125;</span><br><span class="line">//打印结果</span><br><span class="line">&#123;3 0xc000004480 0xc0000044a0&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>go语言没有构造函数的说法,但是可以使用func实现自定义工厂构造函数</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func createNode(value int) *TreeNode &#123;</span><br><span class="line">	//c**函数返回局部变量不可用，不过在go语言中是可以的</span><br><span class="line">	//注意返回的是局部变量的地址</span><br><span class="line">	return &amp;TreeNode&#123;value: value&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为结构体定义方法"><a href="#为结构体定义方法" class="headerlink" title="为结构体定义方法"></a>为结构体定义方法</h3><blockquote>
<p>结构体的方法有一个特点，就是它在函数名前面多了一个接收者</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//定义结构体方法</span><br><span class="line">func (node TreeNode) print() &#123;</span><br><span class="line">	fmt.Print(node.value)</span><br><span class="line">&#125;</span><br><span class="line">//使用结构体方法</span><br><span class="line">func main() &#123;</span><br><span class="line">	node := TreeNode&#123;value: 3&#125;</span><br><span class="line">	node.print()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>go语言中所有方法参数的传递都是值传递，参数会被copy执行，执行过后传递的参数并没有被修改，如需修改需要使用指针</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">type TreeNode struct &#123;</span><br><span class="line">	value int</span><br><span class="line">	left,right *TreeNode</span><br><span class="line">&#125;</span><br><span class="line">func (node TreeNode) print() &#123;</span><br><span class="line">	fmt.Println(node.value)</span><br><span class="line">&#125;</span><br><span class="line">func (node TreeNode) setVal(value int)  &#123;</span><br><span class="line">	node.value = value</span><br><span class="line">&#125;</span><br><span class="line">//解决值传递问题需要加*号以指针的方式即可修改传递过来的值</span><br><span class="line">func (node *TreeNode) setValue(value int)  &#123;</span><br><span class="line">	node.value = value</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">	node := TreeNode&#123;&#125;</span><br><span class="line">	node.print()</span><br><span class="line">	//打印值为0</span><br><span class="line">	node.setVal(1)</span><br><span class="line">	node.print()</span><br><span class="line">	//打印值为0</span><br><span class="line">	node.setValue(2)</span><br><span class="line">	node.print()</span><br><span class="line">	//打印值为2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法的值接收者与指针接收者原则"><a href="#方法的值接收者与指针接收者原则" class="headerlink" title="方法的值接收者与指针接收者原则"></a>方法的值接收者与指针接收者原则</h3><blockquote>
<p>要改变内容必须使用指针接收者</p>
</blockquote>
<blockquote>
<p>结构过大也要考虑使用指针接收者</p>
</blockquote>
<blockquote>
<p>一致性：如果有指针接收者，最好都是用指针接收者</p>
</blockquote>
<blockquote>
<p><strong>值接收者</strong>是go语言特有</p>
</blockquote>
<blockquote>
<p>值/指针接收者既可以接收值也可以接收指针</p>
</blockquote>
<h3 id="遍历树"><a href="#遍历树" class="headerlink" title="遍历树"></a>遍历树</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">type TreeNode struct &#123;</span><br><span class="line">	value int</span><br><span class="line">	left,right *TreeNode</span><br><span class="line">&#125;</span><br><span class="line">func (node TreeNode) print() &#123;</span><br><span class="line">	fmt.Print(node.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (node *TreeNode) traverse() &#123;</span><br><span class="line">	if node == nil &#123;</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	node.left.traverse()</span><br><span class="line">	node.print()</span><br><span class="line">	node.right.traverse()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	root := TreeNode&#123;value:3&#125;</span><br><span class="line">	root.left = &amp;TreeNode&#123;&#125;</span><br><span class="line">	root.right = &amp;TreeNode&#123;value: 5&#125;</span><br><span class="line">	root.left.right = &amp;TreeNode&#123;value: 2&#125;</span><br><span class="line">	root.right.left = &amp;TreeNode&#123;value: 4&#125;</span><br><span class="line">	root.traverse()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行结果 0 2 3 4 5</p>
</blockquote>
<p><strong>遍历树图解</strong></p>
<p><img src="/images/img_10.png" alt="遍历树"></p>
<blockquote>
<p>traverse()函数先遍历左边再遍历自己再遍历右边往复递归</p>
</blockquote>
<h2 id="封装和包"><a href="#封装和包" class="headerlink" title="封装和包"></a>封装和包</h2><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p><strong>定义完方法我们一般要进行封装</strong></p>
<blockquote>
<p>go语言名字一般使用CamelCase</p>
</blockquote>
<blockquote>
<p>方法结构常量等定义首字母大写代表：public(针对包)，</p>
</blockquote>
<blockquote>
<p>方法结构常量等定义首字母小写代表：private(针对包)，</p>
</blockquote>
<h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><blockquote>
<p>每个目录只能有一个包，包名不一定和目录名一样</p>
</blockquote>
<blockquote>
<p>main包包含和执行入口</p>
</blockquote>
<blockquote>
<p>一个目录下面main函数只能有一个main包,否则我们需要给目录起一个其它的名字</p>
</blockquote>
<blockquote>
<p>为结构定义方法必须放在同一个包内，但是可以是不同的文件</p>
</blockquote>
<h3 id="扩展已有类型"><a href="#扩展已有类型" class="headerlink" title="扩展已有类型"></a>扩展已有类型</h3><blockquote>
<p>扩展已有类型可以<u><strong>定义别名</strong></u>或者<u><strong>使用组合</strong></u></p>
</blockquote>
<p><strong>包装TreeNode为MyTreeNode实现新的遍历方式</strong>这里使用的方式是<u><strong>组合</strong></u></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/tree&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type MyTreeNode struct &#123;</span><br><span class="line">	node *tree.Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (myNode *MyTreeNode) postOrder() &#123;</span><br><span class="line">	if myNode == nil || myNode.node == nil &#123;</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	left := MyTreeNode&#123;myNode.node.Left&#125;</span><br><span class="line">	left.postOrder()</span><br><span class="line">	right := MyTreeNode&#123;myNode.node.Right&#125;</span><br><span class="line">	right.postOrder()</span><br><span class="line">	myNode.node.Print()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	root := tree.Node&#123;Value: 3&#125;</span><br><span class="line">	root.Left = &amp;tree.Node&#123;&#125;</span><br><span class="line">	root.Right = &amp;tree.Node&#123;Value: 5&#125;</span><br><span class="line">	root.Left.Right = &amp;tree.Node&#123;Value: 2&#125;</span><br><span class="line">	root.Right.Left = &amp;tree.Node&#123;Value: 4&#125;</span><br><span class="line">	root.Traverse()</span><br><span class="line">	fmt.Println()</span><br><span class="line">	node := MyTreeNode&#123;&amp;root&#125;</span><br><span class="line">	node.postOrder()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>树还是之前的树，就不图解了，遍历结果为 2 0 4 5 3</p>
</blockquote>
<p><strong>定义slice的别名实现一个先进先出的队列</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Queue.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package queue</span><br><span class="line"></span><br><span class="line">//定义一个队列，xian，它是一个int类型的slice</span><br><span class="line">type Queue []int</span><br><span class="line"></span><br><span class="line">//推进队列</span><br><span class="line">func (q *Queue) Push(v int) &#123;</span><br><span class="line">	*q = append(*q,v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//弹出队列</span><br><span class="line">func (q *Queue) Pop() int &#123;</span><br><span class="line">	head := (*q)[0]</span><br><span class="line">	*q = (*q)[1:]</span><br><span class="line">	return head</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//队列元素是否为空</span><br><span class="line">func (q *Queue) IsEmpty() bool &#123;</span><br><span class="line">	return len(*q) == 0</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/queue&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	q := queue.Queue&#123;1&#125;</span><br><span class="line">	q.Push(2)</span><br><span class="line">	q.Push(3)</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.IsEmpty())</span><br><span class="line">	fmt.Println(q.Pop())</span><br><span class="line">	fmt.Println(q.IsEmpty())</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p><strong>打印结果</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">false</span><br><span class="line">3</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<h3 id="安装第三方包goimports"><a href="#安装第三方包goimports" class="headerlink" title="安装第三方包goimports"></a>安装第三方包goimports</h3><blockquote>
<p>移动到一下目录%GOPATH%/src/golang.org/x从github上download以下包</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:golang/tools.git</span><br></pre></td></tr></table></figure>

<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:golang/mod.git</span><br></pre></td></tr></table></figure>

<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:golang/xerrors.git</span><br></pre></td></tr></table></figure>

<p><strong>执行命令安装goimports</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//请将%GOPATH%替换为绝对路径后执行命令</span><br><span class="line">go install %GOPATH%/src/golang.org/x/tools/cmd/goimports</span><br></pre></td></tr></table></figure>

<p><strong>尝试使用第三方库</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;golang.org/x/tools/container/intsets&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func testSparse() &#123;</span><br><span class="line">	sparse := intsets.Sparse&#123;&#125;</span><br><span class="line">	sparse.Insert(1)</span><br><span class="line">	sparse.Insert(2)</span><br><span class="line">	sparse.Insert(3)</span><br><span class="line">	sparse.Insert(4)</span><br><span class="line">	fmt.Println(sparse.Has(5))</span><br><span class="line">	fmt.Println(sparse.Has(4))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	testSparse()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="GOPATH目录结构"><a href="#GOPATH目录结构" class="headerlink" title="GOPATH目录结构"></a>GOPATH目录结构</h3><blockquote>
<p><strong>go build</strong>进行编译</p>
</blockquote>
<blockquote>
<p><strong>go install</strong>产生pkg文件和可执行文件</p>
</blockquote>
<blockquote>
<p><strong>go run</strong>直接编译运行</p>
</blockquote>
<blockquote>
<p>src</p>
<blockquote>
<p>git repository1<br>git repository2</p>
</blockquote>
</blockquote>
<blockquote>
<p>pkg</p>
<blockquote>
<p>git repository1<br>git repository2</p>
</blockquote>
</blockquote>
<blockquote>
<p>bin</p>
<blockquote>
<p>可执行文件1，2，3</p>
</blockquote>
</blockquote>
<h1 id="面向接口"><a href="#面向接口" class="headerlink" title="面向接口"></a>面向接口</h1><blockquote>
<p>go语言的接口是<strong>使用者定义的</strong></p>
</blockquote>
<blockquote>
<p>接口实现是隐式的，无需注明实现了哪个接口，只需拥有接口同样的方法</p>
</blockquote>
<blockquote>
<p>接口变量自带指针</p>
</blockquote>
<blockquote>
<p>接口变量同样采用值传递，几乎不需要使用接口的指针</p>
</blockquote>
<blockquote>
<p>指针接收者实现只能以指针的方式使用；值接收者两者都可以</p>
</blockquote>
<blockquote>
<p>接口变量强制转换用变量接收后后面加’,ok’,可以使用ok判断是否该类型，学名叫<strong>Type assertion</strong></p>
</blockquote>
<blockquote>
<p>除了使用<strong>Type assertion</strong>方式判断类型，也可以使用<strong>switch case</strong>语句的方式来判断类型并执行相关逻辑</p>
</blockquote>
<blockquote>
<p>interface{} 可以表示任何类型</p>
</blockquote>
<h2 id="接口定义"><a href="#接口定义" class="headerlink" title="接口定义"></a>接口定义</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">mockretriever.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package mock</span><br><span class="line"></span><br><span class="line">type Retriever struct &#123;</span><br><span class="line">	Contents string</span><br><span class="line">&#125;</span><br><span class="line">//定义接口实现，无需指明实现了哪个接口，方法只需要实现接口中的方法</span><br><span class="line">func (r Retriever) Get(url string) string &#123;</span><br><span class="line">	return r.Contents</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">realretriever.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package rel</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;net/http/httputil&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Retriever struct &#123;</span><br><span class="line">	UserAgent string</span><br><span class="line">	TimeOut time.Duration</span><br><span class="line">&#125;</span><br><span class="line">//定义接口实现，无需指明实现了哪个接口，方法只需要实现接口中的方法</span><br><span class="line">func (r Retriever) Get(url string) string &#123;</span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	result, err := httputil.DumpResponse(resp, true)</span><br><span class="line">	resp.Body.Close()</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	return string(result)</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/retriever/mock&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/retriever/rel&quot;</span><br><span class="line">)</span><br><span class="line">//定义接口</span><br><span class="line">type Retriever interface &#123;</span><br><span class="line">	Get(url string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func download(r Retriever) string &#123;</span><br><span class="line">	return r.Get(&quot;http://www.baidu.com&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	//接口变量(里面有是闲着类型/实现者的值或实现者的指针(它指向了一个实现者))</span><br><span class="line">	//不要使用接口变量的地址，因为接口变量本身可以包含指针，内部指向实现者即可</span><br><span class="line">	var r Retriever</span><br><span class="line">	//假的retriever</span><br><span class="line">	r = mock.Retriever&#123;Contents: &quot;this is a fack imooc.com&quot;&#125;</span><br><span class="line">	fmt.Println(download(r))</span><br><span class="line">	//真实的retriever</span><br><span class="line">	r = rel.Retriever&#123;&#125;</span><br><span class="line">	fmt.Println(download(r))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接口组合"><a href="#接口组合" class="headerlink" title="接口组合"></a>接口组合</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">mockretriever.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package mock</span><br><span class="line"></span><br><span class="line">type (</span><br><span class="line">	Retriever struct &#123;</span><br><span class="line">		Contents string</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func (r *Retriever) Post(url string, form map[string]string) string &#123;</span><br><span class="line">	r.Contents = form[&quot;contents&quot;]</span><br><span class="line">	return &quot;ok&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (r *Retriever) Get(url string) string &#123;</span><br><span class="line">	return r.Contents</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/retriever/mock&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Retriever interface &#123;</span><br><span class="line">	Get(url string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Poster interface &#123;</span><br><span class="line">	Post(url string,form map[string]string) string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func download(r Retriever) string &#123;</span><br><span class="line">	return r.Get(&quot;http://www.baidu.com&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func post(poster Poster) &#123;</span><br><span class="line">	poster.Post(&quot;http:www.baidu.com&quot;, map[string]string&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;course&quot;:&quot;java&quot;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type RetrieverPoster interface &#123;</span><br><span class="line">	Retriever</span><br><span class="line">	Poster</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const url = &quot;http://www.baidu.com&quot;</span><br><span class="line">func session(s RetrieverPoster) string&#123;</span><br><span class="line">	s.Post(url, map[string]string&#123;&quot;contents&quot;:&quot;anather faked imooc.com&quot;&#125;)</span><br><span class="line">	return s.Get(url)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	var r RetrieverPoster</span><br><span class="line">	r = &amp;mock.Retriever&#123;Contents: &quot;this is a fack imooc.com&quot;&#125;</span><br><span class="line">	//type assertion</span><br><span class="line">	if mockRetriever,ok := r.(*mock.Retriever); ok&#123;</span><br><span class="line">		fmt.Println(mockRetriever.Contents)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		fmt.Println(&quot;not a mock retriever&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(session(r))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常用标准接口"><a href="#常用标准接口" class="headerlink" title="常用标准接口"></a>常用标准接口</h2><h3 id="print-go-—-gt-fmt-Stringer-String-string"><a href="#print-go-—-gt-fmt-Stringer-String-string" class="headerlink" title="print.go —&gt; fmt.Stringer#String() (string)"></a>print.go —&gt; fmt.Stringer#String() (string)</h3><blockquote>
<p>该接口相当于其它语言中的toString</p>
</blockquote>
<h3 id="io-go-—-gt-io-Reader-Read-p-byte-n-int-err-error"><a href="#io-go-—-gt-io-Reader-Read-p-byte-n-int-err-error" class="headerlink" title="io.go —&gt; io.Reader#Read(p []byte) (n int, err error)"></a>io.go —&gt; io.Reader#Read(p []byte) (n int, err error)</h3><blockquote>
<p>文件、网络、byte、slice、string等等都会用Reader#Read</p>
</blockquote>
<h3 id="io-go-—-gt-io-Writer-Write-p-byte-n-int-err-error"><a href="#io-go-—-gt-io-Writer-Write-p-byte-n-int-err-error" class="headerlink" title="io.go —&gt; io.Writer#Write(p []byte) (n int, err error)"></a>io.go —&gt; io.Writer#Write(p []byte) (n int, err error)</h3><blockquote>
<p>文件、网络、byte、slice、string等等都会用Reader#Write</p>
</blockquote>
<h3 id="使用io-go-—-gt-io-Reader-Read-p-byte-代替file示例"><a href="#使用io-go-—-gt-io-Reader-Read-p-byte-代替file示例" class="headerlink" title="使用io.go —&gt; io.Reader#Read(p []byte)代替file示例"></a>使用io.go —&gt; io.Reader#Read(p []byte)代替file示例</h3><blockquote>
<p>这里不仅可以使用文件还可以使用其它字符串等数据类型</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">func printFile(filename string) &#123;</span><br><span class="line">	file, err := os.Open(filename)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	printFileContents(file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func printFileContents(reader io.Reader) &#123;</span><br><span class="line">	scanner := bufio.NewScanner(reader)</span><br><span class="line">	for scanner.Scan() &#123;</span><br><span class="line">		fmt.Println(scanner.Text())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	printFile(&quot;basic/loop/abc.txt&quot;)</span><br><span class="line">	s := `abc&quot;d&quot;</span><br><span class="line">	kkkk</span><br><span class="line">	123</span><br><span class="line">	p`</span><br><span class="line">	printFileContents(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h1><blockquote>
<p>函数是一等公民：参数、变量、返回值等都可以是函数,可以给函数实现接口</p>
</blockquote>
<blockquote>
<p>高阶函数：函数的参数还是一个函数</p>
</blockquote>
<blockquote>
<p>函数—&gt;闭包</p>
</blockquote>
<blockquote>
<p>正统函数式编程</p>
<blockquote>
<p>不可变性：不能有状态，只有常量和函数<br>正统函数只能有一个参数<br>go语言式通用语言，不会再正统函数式做文章</p>
</blockquote>
</blockquote>
<h2 id="使用函数式编程实现一个累加器-闭包"><a href="#使用函数式编程实现一个累加器-闭包" class="headerlink" title="使用函数式编程实现一个累加器(闭包)"></a>使用函数式编程实现一个累加器(闭包)</h2><p><strong>代码</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">//定义函数，返回值是一个函数</span><br><span class="line">func adder() func(int) int &#123;</span><br><span class="line">	sum := 0</span><br><span class="line">	//这里的v既是一个参数又是函数体的一个局部变量</span><br><span class="line">	return  func(v int) int &#123;</span><br><span class="line">		sum += v</span><br><span class="line">		//这里的sum是这个函数体外面定义的，他是一个自有变量</span><br><span class="line">		return sum</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	//这里返回的是一个函数实例，每调用一次函数实例将对实例的返回值进行累加</span><br><span class="line">	funcAdder := adder()</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		fmt.Printf(&quot;0+...+%d = %d\n&quot;,i,funcAdder(i))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行结果</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0+...+0 = 0</span><br><span class="line">0+...+1 = 1</span><br><span class="line">0+...+2 = 3</span><br><span class="line">0+...+3 = 6</span><br><span class="line">0+...+4 = 10</span><br><span class="line">0+...+5 = 15</span><br><span class="line">0+...+6 = 21</span><br><span class="line">0+...+7 = 28</span><br><span class="line">0+...+8 = 36</span><br><span class="line">0+...+9 = 45</span><br></pre></td></tr></table></figure>

<p><img src="/images/img_11.png" alt="闭包"></p>
<blockquote>
<p><strong>自由变量</strong>不断地找与<strong>局部变量</strong>的联系然后整体返回一个<strong>闭包</strong></p>
</blockquote>
<h2 id="以正统函数方式实现累加器"><a href="#以正统函数方式实现累加器" class="headerlink" title="以正统函数方式实现累加器"></a>以正统函数方式实现累加器</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">type innerAdder func(int) (int, innerAdder)</span><br><span class="line"></span><br><span class="line">func adder(base int) innerAdder &#123;</span><br><span class="line">	return func(v int) (int, innerAdder) &#123;</span><br><span class="line">		return base + v, adder(base + v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	innerAdder := adder(0)</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		var s int</span><br><span class="line">		s, innerAdder = innerAdder(i)</span><br><span class="line">		fmt.Printf(&quot;0+...+%d = %d\n&quot;,i,s)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java中的闭包实现累加器"><a href="#java中的闭包实现累加器" class="headerlink" title="java中的闭包实现累加器"></a>java中的闭包实现累加器</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    private static Function&lt;Integer, Integer&gt; adder() &#123;</span><br><span class="line">        final Holder&lt;Integer&gt; sum = new Holder&lt;&gt;(0);</span><br><span class="line">        return (Integer value) -&gt; &#123;</span><br><span class="line">            sum.value += value;</span><br><span class="line">            return sum.value;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Function&lt;Integer, Integer&gt; adder = adder();</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            System.out.println(adder.apply(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>java8后：使用Function接口和lambda表达式来创建函数对象</p>
</blockquote>
<blockquote>
<p>匿名类或者lambda表达式均支持闭包</p>
</blockquote>
<h2 id="斐波那契生成器"><a href="#斐波那契生成器" class="headerlink" title="斐波那契生成器"></a>斐波那契生成器</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">//斐波那契生成器</span><br><span class="line">func fibonacci() func() int &#123;</span><br><span class="line">	a,b := 0,1</span><br><span class="line">	return func() int &#123;</span><br><span class="line">		a,b = b,a+b</span><br><span class="line">		return a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	generate := fibonacci()</span><br><span class="line">	fmt.Println(generate())</span><br><span class="line">	fmt.Println(generate())</span><br><span class="line">	fmt.Println(generate())</span><br><span class="line">	fmt.Println(generate())</span><br><span class="line">	fmt.Println(generate())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现io-Reader遍历斐波那契生成器中的数据"><a href="#实现io-Reader遍历斐波那契生成器中的数据" class="headerlink" title="实现io.Reader遍历斐波那契生成器中的数据"></a>实现io.Reader遍历斐波那契生成器中的数据</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;bufio&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">)</span><br><span class="line">//定义函数类型</span><br><span class="line">type intGen func() int</span><br><span class="line">//为函数类型实现接口</span><br><span class="line">func (g intGen) Read(p []byte) (n int, err error) &#123;</span><br><span class="line">	next := g()</span><br><span class="line">	//斐波那契生成器永远读不完做一个限制</span><br><span class="line">	if next &gt; 10000 &#123;</span><br><span class="line">		return 0,io.EOF</span><br><span class="line">	&#125;</span><br><span class="line">	s := fmt.Sprintf(&quot;%d\n&quot;, next)</span><br><span class="line">	//TODO: 如果p太小则不正确</span><br><span class="line">	return strings.NewReader(s).Read(p)</span><br><span class="line">&#125;</span><br><span class="line">//斐波那契生成器(替换定义类型，它实现了io.Reader接口)</span><br><span class="line">func fibonacci() intGen &#123;</span><br><span class="line">	a,b := 0,1</span><br><span class="line">	return func() int &#123;</span><br><span class="line">		a,b = b,a+b</span><br><span class="line">		return a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//传递reader实现</span><br><span class="line">func printFileContents(reader io.Reader) &#123;</span><br><span class="line">	scanner := bufio.NewScanner(reader)</span><br><span class="line">	//遍历生成器中的数据</span><br><span class="line">	for scanner.Scan() &#123;</span><br><span class="line">		fmt.Println(scanner.Text())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//主函数</span><br><span class="line">func main() &#123;</span><br><span class="line">	//实现reader的斐波那契生成器</span><br><span class="line">	generate := fibonacci()</span><br><span class="line">	//读取斐波那契生成器的数据</span><br><span class="line">	printFileContents(generate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="遍历二叉树传递遍历过程中的操作"><a href="#遍历二叉树传递遍历过程中的操作" class="headerlink" title="遍历二叉树传递遍历过程中的操作"></a>遍历二叉树传递遍历过程中的操作</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">node.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package tree</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func (node Node) setVal(value int)  &#123;</span><br><span class="line">	node.Value = value</span><br><span class="line">&#125;</span><br><span class="line">func (node *Node) setValue(value int)  &#123;</span><br><span class="line">	node.Value = value</span><br><span class="line">&#125;</span><br><span class="line">//定义类型</span><br><span class="line">type Node struct &#123;</span><br><span class="line">	Value      int</span><br><span class="line">	Left,Right *Node</span><br><span class="line">&#125;</span><br><span class="line">//定义print</span><br><span class="line">func (node Node) Print() &#123;</span><br><span class="line">	fmt.Print(node.Value,&quot; &quot;)</span><br><span class="line">&#125;</span><br><span class="line">//遍历树</span><br><span class="line">func (node *Node) Traverse() &#123;</span><br><span class="line">	node.TraverseFunc(func(n *Node) &#123;</span><br><span class="line">		if node == nil &#123;</span><br><span class="line">			return</span><br><span class="line">		&#125;</span><br><span class="line">		n.Print()</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line">//遍历树同时做什么操作由传递的函数决定</span><br><span class="line">func (node *Node) TraverseFunc(f func(node *Node)) &#123;</span><br><span class="line">	if node == nil &#123;</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	node.Left.TraverseFunc(f)</span><br><span class="line">	f(node)</span><br><span class="line">	node.Right.TraverseFunc(f)</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/tree&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	root := tree.Node&#123;Value: 3&#125;</span><br><span class="line">	root.Left = &amp;tree.Node&#123;&#125;</span><br><span class="line">	root.Right = &amp;tree.Node&#123;Value: 5&#125;</span><br><span class="line">	root.Left.Right = &amp;tree.Node&#123;Value: 2&#125;</span><br><span class="line">	root.Right.Left = &amp;tree.Node&#123;Value: 4&#125;</span><br><span class="line">	root.Traverse()</span><br><span class="line">	count := 0</span><br><span class="line">	root.TraverseFunc(func(node *tree.Node) &#123;</span><br><span class="line">		count++</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(&quot;Noce count&quot;,count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="错误处理与资源管理"><a href="#错误处理与资源管理" class="headerlink" title="错误处理与资源管理"></a>错误处理与资源管理</h1><h2 id="defer调用"><a href="#defer调用" class="headerlink" title="defer调用"></a>defer调用</h2><blockquote>
<p>defer确保在函数结束时发生调用</p>
</blockquote>
<blockquote>
<p>参数在defer语句时计算(for loop 会栈执行)</p>
</blockquote>
<blockquote>
<p>defer调用里面时栈存储，先进后出</p>
</blockquote>
<h3 id="defer调用使用斐波那契生成器写入文件关闭资源操作"><a href="#defer调用使用斐波那契生成器写入文件关闭资源操作" class="headerlink" title="defer调用使用斐波那契生成器写入文件关闭资源操作"></a>defer调用使用斐波那契生成器写入文件关闭资源操作</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">fib.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package fib</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type fibIntGen func() int</span><br><span class="line"></span><br><span class="line">//为函数类型实现接口</span><br><span class="line">func (g fibIntGen) Read(p []byte) (n int, err error) &#123;</span><br><span class="line">	next := g()</span><br><span class="line">	//斐波那契生成器永远读不完做一个限制</span><br><span class="line">	if next &gt; 10000 &#123;</span><br><span class="line">		return 0, io.EOF</span><br><span class="line">	&#125;</span><br><span class="line">	s := fmt.Sprintf(&quot;%d\n&quot;, next)</span><br><span class="line">	return strings.NewReader(s).Read(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Fibonacci() fibIntGen &#123;</span><br><span class="line">	a, b := 0, 1</span><br><span class="line">	return func() int &#123;</span><br><span class="line">		a, b = b, a+b</span><br><span class="line">		return a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;bufio&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/functional/fibonacci/fib&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func writeFile(filename string) &#123;</span><br><span class="line">	file, err := os.Create(filename)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	//关闭文件资源</span><br><span class="line">	defer file.Close()</span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	//将数据写入文件</span><br><span class="line">	defer writer.Flush()</span><br><span class="line">	fibonacci := fib.Fibonacci()</span><br><span class="line">	for i := 0; i &lt; 20; i++ &#123;</span><br><span class="line">		fmt.Fprintln(writer,fibonacci())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	writeFile(&quot;fib.txt&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于defer调用是栈类型，writer.Flush()会比file.Close()先执行</p>
</blockquote>
<blockquote>
<p>defer在写代码的时候就想到创建file就要关闭，创建writer就要想到flush</p>
</blockquote>
<h3 id="何时使用defer调用"><a href="#何时使用defer调用" class="headerlink" title="何时使用defer调用"></a>何时使用defer调用</h3><h4 id="Open-Close"><a href="#Open-Close" class="headerlink" title="Open/Close"></a>Open/Close</h4><h4 id="Lock-Unlock"><a href="#Lock-Unlock" class="headerlink" title="Lock/Unlock"></a>Lock/Unlock</h4><h4 id="PrintHeader-PrintFooter"><a href="#PrintHeader-PrintFooter" class="headerlink" title="PrintHeader/PrintFooter"></a>PrintHeader/PrintFooter</h4><h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;bufio&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/functional/fibonacci/fib&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func writeFile(filename string) &#123;</span><br><span class="line">	// If there is an error, it will be of type *PathError.</span><br><span class="line">	file, err := os.OpenFile(filename, os.O_EXCL|os.O_CREATE, 0666)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		//如果是*os.PathError，打印指定信息</span><br><span class="line">		if pathError,ok := err.(*os.PathError); ok &#123;</span><br><span class="line">			fmt.Println(pathError.Op,pathError.Path,pathError.Err)</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			//否则打印正常错误信息</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	defer file.Close()</span><br><span class="line"></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	defer writer.Flush()</span><br><span class="line"></span><br><span class="line">	fibonacci := fib.Fibonacci()</span><br><span class="line">	for i := 0; i &lt; 20; i++ &#123;</span><br><span class="line">		fmt.Fprintln(writer,fibonacci())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	writeFile(&quot;fib.txt&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="统一错误处理"><a href="#统一错误处理" class="headerlink" title="统一错误处理"></a>统一错误处理</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">handler.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package filelisting</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//包装为http.HandleFunc(pattern string, handler func(ResponseWriter, *Request))的第二个参数</span><br><span class="line">func HandleFileList(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	path := request.URL.Path[len(&quot;/list/&quot;):]</span><br><span class="line">	file, err := os.Open(path)</span><br><span class="line">	//错误文件路径会控制台会报错，我们需要对错误进行统一处理</span><br><span class="line">	//panic serving [::1]:55751: open fib.txt1: The system cannot find the file specified.</span><br><span class="line">	/*if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;*/</span><br><span class="line">	//内部错误展示给用户不太好，需要进行包装</span><br><span class="line">	/*if err != nil &#123;</span><br><span class="line">		http.Error(writer,</span><br><span class="line">			err.Error(),</span><br><span class="line">			http.StatusInternalServerError)</span><br><span class="line">		return</span><br><span class="line">	&#125;*/</span><br><span class="line">	//错误直接返回使用通用处理方法</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	defer file.Close()</span><br><span class="line">	content, err := ioutil.ReadAll(file)</span><br><span class="line">	if  err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	writer.Write(content)</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">web.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/errhanding/filelistingserver/filelisting&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//定义函数类型对函数进行包装</span><br><span class="line">type appHandler func(writer http.ResponseWriter, request *http.Request) error</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">统一错误处理方法</span><br><span class="line">1.http.HandleFun函数的第二个参数是一个func(ResponseWriter, *Request)</span><br><span class="line">2.使用errWrapper方法对其进行包装返回一个func(ResponseWriter, *Request)</span><br><span class="line">3.handler(writer,request)执行过程中如果报错就会返回err，然后对err进行处理</span><br><span class="line">*/</span><br><span class="line">func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) &#123;</span><br><span class="line">	//包装一个函数，返回一个函数，在返回一个无返回值的函数中进行处理</span><br><span class="line">	return func(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">		//这个handler实质就是filelisting.HandleFileList</span><br><span class="line">		err := handler(writer, request)</span><br><span class="line">		if err != nil &#123;</span><br><span class="line">			//控制台打印错误信息</span><br><span class="line">			log.Warn(&quot;Error handling request: %s&quot;,err.Error())</span><br><span class="line">			//赋值默认值</span><br><span class="line">			code := http.StatusOK</span><br><span class="line">			switch &#123;</span><br><span class="line">			//文件不存在code</span><br><span class="line">			case os.IsNotExist(err):</span><br><span class="line">				code = http.StatusNotFound</span><br><span class="line">			//权限不够禁止访问</span><br><span class="line">			case os.IsPermission(err):</span><br><span class="line">				code = http.StatusForbidden</span><br><span class="line">			//默认系统内部异常code</span><br><span class="line">			default:</span><br><span class="line">				code = http.StatusInternalServerError</span><br><span class="line">			&#125;</span><br><span class="line">			//将错误消息响应给客户端</span><br><span class="line">			http.Error(writer, http.StatusText(code), code)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	http.HandleFunc(&quot;/list/&quot;, errWrapper(filelisting.HandleFileList))</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(&quot;:8888&quot;, nil)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="panic与recover"><a href="#panic与recover" class="headerlink" title="panic与recover"></a>panic与recover</h2><h3 id="panic-恐慌"><a href="#panic-恐慌" class="headerlink" title="panic(恐慌)"></a>panic(恐慌)</h3><p><img src="/images/img_12.png" alt="看到panic想到这幅图(重)"></p>
<blockquote>
<p>panic是一个很重的词，尽量少用</p>
</blockquote>
<blockquote>
<p>停止当前函数执行(跟其它语言的throw Exception有点像)</p>
</blockquote>
<blockquote>
<p>一致向上返回，执行每一层的defer调用</p>
</blockquote>
<blockquote>
<p>如果没有遇见recover，程序退出</p>
</blockquote>
<h3 id="recover-恢复"><a href="#recover-恢复" class="headerlink" title="recover(恢复)"></a>recover(恢复)</h3><blockquote>
<p>仅在defer调用中使用</p>
</blockquote>
<blockquote>
<p>在defer调用recover里面可以获取panic的值进行处理</p>
</blockquote>
<blockquote>
<p>如果在defer调用中无法处理panic的值，可以重新panic</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	tryRecover()</span><br><span class="line">	fmt.Println(&quot;test&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func tryRecover() &#123;</span><br><span class="line">	//匿名函数</span><br><span class="line">	defer func() &#123;</span><br><span class="line">		//defer调用遇见recover</span><br><span class="line">		r := recover()</span><br><span class="line">		//如果是一个错误对错误进行处理</span><br><span class="line">		if err, ok := r.(error); ok &#123;</span><br><span class="line">			fmt.Println(&quot;Error occurred:&quot;, err)</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			//否则重新panic</span><br><span class="line">			//panic(r)</span><br><span class="line">			panic(fmt.Sprintf(&quot;I don&apos;t know what to do: %v&quot;,err))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;() //大括号是匿名函数的函数体，我们需要匿名函数被调用在函数体后面需要加上小括号</span><br><span class="line">	//recover这个错误我们在defer中调用</span><br><span class="line">	//panic(errors.New(&quot;this is an error&quot;))</span><br><span class="line">	//b := 0</span><br><span class="line">	//a := 5 / b</span><br><span class="line">	//fmt.Println(a)</span><br><span class="line">	panic(123)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>对统一错误处理进行改进 使用dever调用recover</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">//http.HandleFunc调用到server.go文件中的func (c *conn) serve(ctx context.Context)方法走了defer调用recover</span><br><span class="line">	defer func() &#123;</span><br><span class="line">		if err := recover(); err != nil &amp;&amp; err != ErrAbortHandler &#123;</span><br><span class="line">			const size = 64 &lt;&lt; 10</span><br><span class="line">			buf := make([]byte, size)</span><br><span class="line">			buf = buf[:runtime.Stack(buf, false)]</span><br><span class="line">			c.server.logf(&quot;http: panic serving %v: %v\n%s&quot;, c.remoteAddr, err, buf)</span><br><span class="line">		&#125;</span><br><span class="line">		if !c.hijacked() &#123;</span><br><span class="line">			c.close()</span><br><span class="line">			c.setState(c.rwc, StateClosed)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">web.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">//我们手动处理更友好，处理未知错误，友好相应给客户端</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/errhanding/filelistingserver/filelisting&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//定义函数类型对函数进行包装</span><br><span class="line">type appHandler func(writer http.ResponseWriter, request *http.Request) error</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">统一错误处理方法</span><br><span class="line">1.http.HandleFun函数的第二个参数是一个func(ResponseWriter, *Request)</span><br><span class="line">2.使用errWrapper方法对其进行包装返回一个func(ResponseWriter, *Request)</span><br><span class="line">3.handler(writer,request)执行过程中如果报错就会返回err，然后对err进行处理</span><br><span class="line">*/</span><br><span class="line">func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) &#123;</span><br><span class="line">	//包装一个函数，返回一个函数，在返回一个无返回值的函数中进行处理</span><br><span class="line">	return func(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">		//defer对未知错误进行处理！！！！！！！！！！！！！！</span><br><span class="line">		defer func() &#123;</span><br><span class="line">			if r := recover(); r != nil &#123;</span><br><span class="line">				log.Printf(&quot;Panic: %v&quot;, r)</span><br><span class="line">				http.Error(writer, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line"></span><br><span class="line">		//这个handler实质就是filelisting.HandleFileList</span><br><span class="line">		err := handler(writer, request)</span><br><span class="line">		if err != nil &#123;</span><br><span class="line">			//控制台打印错误信息</span><br><span class="line">			log.Printf(&quot;Error occurred handling request: %s&quot;, err.Error())</span><br><span class="line">			//赋值默认值</span><br><span class="line">			code := http.StatusOK</span><br><span class="line">			switch &#123;</span><br><span class="line">			//文件不存在code</span><br><span class="line">			case os.IsNotExist(err):</span><br><span class="line">				code = http.StatusNotFound</span><br><span class="line">			//权限不够禁止访问</span><br><span class="line">			case os.IsPermission(err):</span><br><span class="line">				code = http.StatusForbidden</span><br><span class="line">			//默认系统内部异常code</span><br><span class="line">			default:</span><br><span class="line">				code = http.StatusInternalServerError</span><br><span class="line">			&#125;</span><br><span class="line">			//将错误消息响应给客户端</span><br><span class="line">			http.Error(writer, http.StatusText(code), code)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	http.HandleFunc(&quot;/&quot;, errWrapper(filelisting.HandleFileList))</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(&quot;:8888&quot;, nil)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>自定义用户错误处理未知错误给前端友好提示(终极版)</strong></p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">handler.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package filelisting</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const prefix = &quot;/list/&quot;</span><br><span class="line"></span><br><span class="line">type userError string</span><br><span class="line">//error接口有一个Error方法相当于实现了error接口</span><br><span class="line">func (e userError) Error() string &#123;</span><br><span class="line">	return e.Message()</span><br><span class="line">&#125;</span><br><span class="line">//userError包装了一个Message方法，这两个方法相当于实现了userError接口及error接口</span><br><span class="line">func (e userError) Message() string &#123;</span><br><span class="line">	return string(e)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//包装为http.HandleFunc(pattern string, handler func(ResponseWriter, *Request))的第二个参数</span><br><span class="line">func HandleFileList(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	if strings.Index(request.URL.Path, prefix) != 0 &#123;</span><br><span class="line">		//return errors.New(&quot;path mast start with :&quot; + prefix)</span><br><span class="line">		return userError(&quot;path must start with: &quot;+prefix)</span><br><span class="line">	&#125;</span><br><span class="line">	path := request.URL.Path[len(prefix):]</span><br><span class="line">	file, err := os.Open(path)</span><br><span class="line">	//错误文件路径会控制台会报错，我们需要对错误进行统一处理</span><br><span class="line">	//panic serving [::1]:55751: open fib.txt1: The system cannot find the file specified.</span><br><span class="line">	/*if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;*/</span><br><span class="line">	//内部错误展示给用户不太好，需要进行包装</span><br><span class="line">	/*if err != nil &#123;</span><br><span class="line">		http.Error(writer,</span><br><span class="line">			err.Error(),</span><br><span class="line">			http.StatusInternalServerError)</span><br><span class="line">		return</span><br><span class="line">	&#125;*/</span><br><span class="line">	//错误直接返回使用通用处理方法</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	defer file.Close()</span><br><span class="line">	content, err := ioutil.ReadAll(file)</span><br><span class="line">	if  err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">	writer.Write(content)</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">web.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/errhanding/filelistingserver/filelisting&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//定义函数类型对函数进行包装</span><br><span class="line">type appHandler func(writer http.ResponseWriter, request *http.Request) error</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">统一错误处理方法</span><br><span class="line">1.http.HandleFun函数的第二个参数是一个func(ResponseWriter, *Request)</span><br><span class="line">2.使用errWrapper方法对其进行包装返回一个func(ResponseWriter, *Request)</span><br><span class="line">3.handler(writer,request)执行过程中如果报错就会返回err，然后对err进行处理</span><br><span class="line">*/</span><br><span class="line">func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) &#123;</span><br><span class="line">	//包装一个函数，返回一个函数，在返回一个无返回值的函数中进行处理</span><br><span class="line">	return func(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">		//defer对未知错误进行处理！！！！！！！！！！！！！！</span><br><span class="line">		defer func() &#123;</span><br><span class="line">			if r := recover(); r != nil &#123;</span><br><span class="line">				log.Printf(&quot;Panic: %v&quot;, r)</span><br><span class="line">				http.Error(writer, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line"></span><br><span class="line">		//这个handler实质就是filelisting.HandleFileList</span><br><span class="line">		err := handler(writer, request)</span><br><span class="line">		if err != nil &#123;</span><br><span class="line">			//控制台打印错误信息</span><br><span class="line">			log.Printf(&quot;Error occurred handling request: %s&quot;, err.Error())</span><br><span class="line">			//如果错误是希望展示给用户的错误</span><br><span class="line">			if userError, ok := err.(userError); ok &#123;</span><br><span class="line">				http.Error(writer,userError.Message(),http.StatusBadRequest)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			//赋值默认值</span><br><span class="line">			code := http.StatusOK</span><br><span class="line">			switch &#123;</span><br><span class="line">			//文件不存在code</span><br><span class="line">			case os.IsNotExist(err):</span><br><span class="line">				code = http.StatusNotFound</span><br><span class="line">			//权限不够禁止访问</span><br><span class="line">			case os.IsPermission(err):</span><br><span class="line">				code = http.StatusForbidden</span><br><span class="line">			//默认系统内部异常code</span><br><span class="line">			default:</span><br><span class="line">				code = http.StatusInternalServerError</span><br><span class="line">			&#125;</span><br><span class="line">			//将错误消息响应给客户端</span><br><span class="line">			http.Error(writer, http.StatusText(code), code)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//定义能给用户看的错误</span><br><span class="line">type userError interface &#123;</span><br><span class="line">	error</span><br><span class="line">	Message() string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	http.HandleFunc(&quot;/&quot;, errWrapper(filelisting.HandleFileList))</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(&quot;:8888&quot;, nil)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="测试与性能调优"><a href="#测试与性能调优" class="headerlink" title="测试与性能调优"></a>测试与性能调优</h1><h2 id="表格驱动测试"><a href="#表格驱动测试" class="headerlink" title="表格驱动测试"></a>表格驱动测试</h2><blockquote>
<p>方法名称以func TestXxx(t *testing.T)格式</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;math&quot;</span><br><span class="line">	&quot;testing&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//测试方法参数需要添加*testing.T作为方法参数</span><br><span class="line">func TestTriangle(t *testing.T) &#123;</span><br><span class="line">	tests := []struct&#123; a, b, c int &#125;&#123;</span><br><span class="line">		&#123;3, 4, 6&#125;,</span><br><span class="line">		&#123;5, 12, 13&#125;,</span><br><span class="line">		&#123;8, 15, 17&#125;,</span><br><span class="line">		&#123;30000, 40000, 50000&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for _, element := range tests &#123;</span><br><span class="line">		if actual := calcTriangle(element.a, element.b); actual != element.c &#123;</span><br><span class="line">			t.Errorf(&quot;calcTriangle(%d,%d) got %d ; expected %d&quot;,element.a,element.b,actual,element.c)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//计算勾股定理</span><br><span class="line">func calcTriangle(a int, b int) int &#123;</span><br><span class="line">	var c int</span><br><span class="line">	c = int(math.Sqrt(float64(a*a + b*b)))</span><br><span class="line">	return c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">打印结果</span><br><span class="line">------------------------------------------------------</span><br><span class="line">API server listening at: [::]:50325</span><br><span class="line">=== RUN   TestTriangle</span><br><span class="line">    add_test.go:17: calcTriangle(3,4) got 5 ; expected 6</span><br><span class="line">--- FAIL: TestTriangle (0.00s)</span><br><span class="line">FAIL</span><br><span class="line"></span><br><span class="line">Debugger finished with exit code 0</span><br><span class="line">------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h2 id="查看代码覆盖率"><a href="#查看代码覆盖率" class="headerlink" title="查看代码覆盖率"></a>查看代码覆盖率</h2><blockquote>
<p>先生成代码覆盖率文件</p>
</blockquote>
 <figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go test -coverprofile=c.out</span><br></pre></td></tr></table></figure>


<blockquote>
<p>使用可视化工具查看文件</p>
</blockquote>
 <figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool cover -html=c.out</span><br></pre></td></tr></table></figure>


<p><img src="/images/img_13.png" alt="代码覆盖率可视化查看"></p>
<blockquote>
<p>红色是没有覆盖的代码</p>
</blockquote>
<blockquote>
<p>绿色是覆盖的代码</p>
</blockquote>
<h2 id="代码性能测试"><a href="#代码性能测试" class="headerlink" title="代码性能测试"></a>代码性能测试</h2><blockquote>
<p>方法名称以func Benchmark(b *testing.B)格式</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;math&quot;</span><br><span class="line">	&quot;testing&quot;</span><br><span class="line">)</span><br><span class="line">//性能测试代码</span><br><span class="line">func BenchmarkSubStr(b *testing.B) &#123;</span><br><span class="line">	s := &quot;黑化肥挥发发灰会花飞灰化肥挥发发黑会飞花&quot;</span><br><span class="line">	ans := 8</span><br><span class="line">	//b.N让系统决定代码性能执行的次数</span><br><span class="line">	for i := 0; i &lt; b.N; i++ &#123;</span><br><span class="line">		actual := lengthOfLongestSubstring(s)</span><br><span class="line">		if actual != ans &#123;</span><br><span class="line">			b.Errorf(&quot;got %d for input %s; expected %d&quot;, actual,s,ans)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//需要进行性能测试的方法快</span><br><span class="line">func lengthOfLongestSubstring(s string) int &#123;</span><br><span class="line">	//记录每个字母最后出现的位置</span><br><span class="line">	lastOccurred := make(map[rune]int)</span><br><span class="line">	start := 0</span><br><span class="line">	maxLenght := 0</span><br><span class="line">	for i,ch := range []rune(s) &#123;</span><br><span class="line">		//有可能不存在这个map获取出来的值是0,而0又是一个合法的下标，所以要判断这个key是否存在</span><br><span class="line">		if lastI,ok := lastOccurred[ch] ; ok &amp;&amp; lastI &gt;= start &#123;</span><br><span class="line">			start = lastOccurred[ch] +1</span><br><span class="line">		&#125;</span><br><span class="line">		if i - start +1 &gt; maxLenght &#123;</span><br><span class="line">			maxLenght = i - start + 1</span><br><span class="line">		&#125;</span><br><span class="line">		lastOccurred[ch] = i</span><br><span class="line">	&#125;</span><br><span class="line">	return maxLenght</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">打印结果</span><br><span class="line">------------------------------------------------------</span><br><span class="line">API server listening at: [::]:62673</span><br><span class="line">goos: windows</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: world.ismyfree/go-learning/basic/loop</span><br><span class="line">BenchmarkSubStr</span><br><span class="line">BenchmarkSubStr-8   	  523216	      2315 ns/op</span><br><span class="line">PASS</span><br><span class="line"></span><br><span class="line">Debugger finished with exit code 0</span><br><span class="line">------------------------------------------------------</span><br></pre></td></tr></table></figure>

<blockquote>
<p>也可以使用命令行对代码进行测试</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go test -bench .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>生成性能测试生成cpu报告</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go test -bench . -cpuprofile cpu.out</span><br></pre></td></tr></table></figure>

<h3 id="使用pprof工具查看cpu-out报告文件"><a href="#使用pprof工具查看cpu-out报告文件" class="headerlink" title="使用pprof工具查看cpu.out报告文件"></a>使用pprof工具查看cpu.out报告文件</h3><blockquote>
<p>输入命令进入工具命令行</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof cpu.out</span><br></pre></td></tr></table></figure>

<blockquote>
<p>进入命令行工具后输入web命令即可以图形化网页形式展示性能问题，针对问题进行调优</p>
</blockquote>
<blockquote>
<p>输入help可查看帮助命令</p>
</blockquote>
<blockquote>
<p>各种报错没能成功，有时间再研究</p>
</blockquote>
<h2 id="http测试"><a href="#http测试" class="headerlink" title="http测试"></a>http测试</h2><h3 id="仅对函数进行测试-更像单元测试"><a href="#仅对函数进行测试-更像单元测试" class="headerlink" title="仅对函数进行测试(更像单元测试)"></a>仅对函数进行测试(更像单元测试)</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">errorwrapper_test.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;errors&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;net/http/httptest&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">	&quot;testing&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type testingUserError string</span><br><span class="line"></span><br><span class="line">//error接口有一个Error方法相当于实现了error接口</span><br><span class="line">func (e testingUserError) Error() string &#123;</span><br><span class="line">	return e.Message()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//testingUserError包装了一个Message方法，这两个方法相当于实现了testingUserError接口及error接口</span><br><span class="line">func (e testingUserError) Message() string &#123;</span><br><span class="line">	return string(e)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errPanic(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	panic(123)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errUserError(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return testingUserError(&quot;user error&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errNotFound(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return os.ErrNotExist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errNoPermission(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return os.ErrPermission</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errUnknown(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return errors.New(&quot;unknown error&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func noError(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	fmt.Fprintln(writer, &quot;no error&quot;)</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func TestErrWrapper(t *testing.T) &#123;</span><br><span class="line">	tests := []struct &#123;</span><br><span class="line">		h       appHandler</span><br><span class="line">		code    int</span><br><span class="line">		message string</span><br><span class="line">	&#125;&#123;</span><br><span class="line">		&#123;errPanic, 500, &quot;Internal Server Error&quot;&#125;,</span><br><span class="line">		&#123;errUserError, 400, &quot;user error&quot;&#125;,</span><br><span class="line">		&#123;errNotFound, 404, &quot;Not Found&quot;&#125;,</span><br><span class="line">		&#123;errNoPermission, 403, &quot;Forbidden&quot;&#125;,</span><br><span class="line">		&#123;errUnknown, 500, &quot;Internal Server Error&quot;&#125;,</span><br><span class="line">		&#123;noError,200,&quot;no error&quot;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for _, tt := range tests &#123;</span><br><span class="line">		f := errWrapper(tt.h)</span><br><span class="line">		response := httptest.NewRecorder()</span><br><span class="line">		request := httptest.NewRequest(http.MethodGet, &quot;http://localhost:8888/list/fib.txt&quot;, nil)</span><br><span class="line">		f(response, request)</span><br><span class="line">		b, _ := ioutil.ReadAll(response.Body)</span><br><span class="line">		body := strings.Trim(string(b), &quot;\n&quot;)</span><br><span class="line">		if response.Code != tt.code || body != tt.message &#123;</span><br><span class="line">			t.Errorf(&quot;expect (%d,%s); got (%d, %s)&quot;, tt.code, tt.message, response.Code, body)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line">响应结果</span><br><span class="line">------------------------------------------------------</span><br><span class="line">API server listening at: [::]:50904</span><br><span class="line">=== RUN   TestErrWrapper</span><br><span class="line">2020/12/28 17:26:00 Panic: 123</span><br><span class="line">2020/12/28 17:26:00 Error occurred handling request: user error</span><br><span class="line">2020/12/28 17:26:00 Error occurred handling request: file does not exist</span><br><span class="line">2020/12/28 17:26:00 Error occurred handling request: permission denied</span><br><span class="line">2020/12/28 17:26:00 Error occurred handling request: unknown error</span><br><span class="line">--- PASS: TestErrWrapper (0.01s)</span><br><span class="line">PASS</span><br><span class="line"></span><br><span class="line">Debugger finished with exit code 0</span><br><span class="line">------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="开一个服务器对http进行测试-集成度更高"><a href="#开一个服务器对http进行测试-集成度更高" class="headerlink" title="开一个服务器对http进行测试(集成度更高)"></a>开一个服务器对http进行测试(集成度更高)</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">errorwrapper_test.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;errors&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;net/http/httptest&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">	&quot;testing&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type testingUserError string</span><br><span class="line"></span><br><span class="line">//error接口有一个Error方法相当于实现了error接口</span><br><span class="line">func (e testingUserError) Error() string &#123;</span><br><span class="line">	return e.Message()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//testingUserError包装了一个Message方法，这两个方法相当于实现了testingUserError接口及error接口</span><br><span class="line">func (e testingUserError) Message() string &#123;</span><br><span class="line">	return string(e)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errPanic(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	panic(123)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errUserError(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return testingUserError(&quot;user error&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errNotFound(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return os.ErrNotExist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errNoPermission(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return os.ErrPermission</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func errUnknown(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	return errors.New(&quot;unknown error&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func noError(writer http.ResponseWriter, request *http.Request) error &#123;</span><br><span class="line">	fmt.Fprintln(writer, &quot;no error&quot;)</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func TestErrWrapperInServer(t *testing.T) &#123;</span><br><span class="line">	tests := []struct &#123;</span><br><span class="line">		h       appHandler</span><br><span class="line">		code    int</span><br><span class="line">		message string</span><br><span class="line">	&#125;&#123;</span><br><span class="line">		&#123;errPanic, 500, &quot;Internal Server Error&quot;&#125;,</span><br><span class="line">		&#123;errUserError, 400, &quot;user error&quot;&#125;,</span><br><span class="line">		&#123;errNotFound, 404, &quot;Not Found&quot;&#125;,</span><br><span class="line">		&#123;errNoPermission, 403, &quot;Forbidden&quot;&#125;,</span><br><span class="line">		&#123;errUnknown, 500, &quot;Internal Server Error&quot;&#125;,</span><br><span class="line">		&#123;noError, 200, &quot;no error&quot;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	for _, tt := range tests &#123;</span><br><span class="line">		f := errWrapper(tt.h)</span><br><span class="line">		server := httptest.NewServer(http.HandlerFunc(f))</span><br><span class="line">		resp, _ := http.Get(server.URL)</span><br><span class="line">		verifyResponse(resp,tt.code,tt.message,t)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func verifyResponse(resp *http.Response,expectCode int,expectMessage string,t *testing.T) &#123;</span><br><span class="line">	b, _ := ioutil.ReadAll(resp.Body)</span><br><span class="line">	body := strings.Trim(string(b), &quot;\n&quot;)</span><br><span class="line">	if resp.StatusCode != expectCode || body != expectMessage &#123;</span><br><span class="line">		t.Errorf(&quot;expect (%d,%s); got (%d, %s)&quot;, expectCode, expectMessage, resp.StatusCode, body)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看接口文档"><a href="#查看接口文档" class="headerlink" title="查看接口文档"></a>查看接口文档</h2><blockquote>
<p>需要安装godoc工具</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install golang.org/x/tools/cmd/godoc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行命令查看接口文档</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">godoc -http=:6060</span><br></pre></td></tr></table></figure>

<blockquote>
<p>打开本地端口网页6060查看(所有接口文档,包含本地及官方)</p>
</blockquote>
<p><img src="/images/img_14.png" alt="web页面接口文档"></p>
<h1 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h1><h2 id="协程Coroutine"><a href="#协程Coroutine" class="headerlink" title="协程Coroutine"></a>协程Coroutine</h2><blockquote>
<p>轻量级”线程”</p>
</blockquote>
<blockquote>
<p><strong>非抢占式</strong>多任务处理，由协程主动交出控制权</p>
</blockquote>
<blockquote>
<p>编译器/解释器/虚拟机层的多任务</p>
</blockquote>
<blockquote>
<p>多个协程可以在一个或者多个线程上运行</p>
</blockquote>
<blockquote>
<p>子程序是协程的一个特例(协程是比子程序更宽泛的一个概念)</p>
</blockquote>
<p><img src="/images/img_15.png" alt="协程与普通函数的对比"></p>
<h3 id="协程简单演示go-func"><a href="#协程简单演示go-func" class="headerlink" title="协程简单演示go func"></a>协程简单演示go func</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;runtime&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	var a [10]int</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		//协程</span><br><span class="line">		go func(i int) &#123;</span><br><span class="line">			for true &#123;</span><br><span class="line">				//id操作协程之间会切换</span><br><span class="line">				//fmt.Printf(&quot;hello from goroutine %d&quot;,i)</span><br><span class="line">				a[i]++</span><br><span class="line">				//手动交出协程控制权</span><br><span class="line">				runtime.Gosched()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此段代码有数据访问冲突,可以使用以下命令进行检测</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run -race xxx.go</span><br></pre></td></tr></table></figure>

<blockquote>
<p>命令执行结果如下</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">//读</span><br><span class="line">Read at 0x00c0001300f0 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      D:/goProject/src/world.ismyfree/go-learning/goroutine/goroutine.go:24 +0x104</span><br><span class="line">//写</span><br><span class="line">Previous write at 0x00c0001300f0 by goroutine 7:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      D:/goProject/src/world.ismyfree/go-learning/goroutine/goroutine.go:17 +0x6f</span><br><span class="line"></span><br><span class="line">Goroutine 7 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      D:/goProject/src/world.ismyfree/go-learning/goroutine/goroutine.go:13 +0xca</span><br><span class="line">==================</span><br><span class="line">[4400 3695 3707 3321 3159 2643 2964 2641 2969 2490]</span><br><span class="line">Found 1 data race(s)</span><br><span class="line">exit status 66</span><br></pre></td></tr></table></figure>

<h3 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h3><p><img src="/images/img_16.png" alt="goroutine抽象图"></p>
<blockquote>
<p>任何函数只要加上go就能送给调度器运行</p>
</blockquote>
<blockquote>
<p>不需要在定义是区分是否是异步函数</p>
</blockquote>
<blockquote>
<p>调度器在合适的点进行切换</p>
</blockquote>
<blockquote>
<p>使用-race可以检测数据访问冲突</p>
</blockquote>
<blockquote>
<p>调度器会将各个协程映射到物理机的各个线程</p>
</blockquote>
<h3 id="goroutine可能切换的参考点"><a href="#goroutine可能切换的参考点" class="headerlink" title="goroutine可能切换的参考点"></a>goroutine可能切换的参考点</h3><blockquote>
<p>I/O,select (如print)<br>d<br>channel</p>
</blockquote>
<blockquote>
<p>等待锁</p>
</blockquote>
<blockquote>
<p>函数调用(有时)</p>
</blockquote>
<blockquote>
<p>runtime.Gosched()(手动交出协程控制权)</p>
</blockquote>
<h2 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h2><p><img src="/images/img_17.png" alt="channel"></p>
<blockquote>
<p>goroutine与goroutine之间双向的通道就是channel</p>
</blockquote>
<blockquote>
<p>channel是goroutine与goroutine之间的交互，一个goroutine发送数据就要有一个goroutine接收数据，没有goroutine接收数据会发生dadelock</p>
</blockquote>
<blockquote>
<p>channel</p>
<blockquote>
<p>channel<br>buffered channel<br>range</p>
<blockquote>
<p>理论基础：Communication Sequential Process (CSP模型)</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<p>不要通过共享内存来通信;<strong>通过通信来共享内存</strong></p>
</blockquote>
<h3 id="channel的示例"><a href="#channel的示例" class="headerlink" title="channel的示例"></a>channel的示例</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//worker是一个goroutine</span><br><span class="line">func worker(id int, c chan int) &#123;</span><br><span class="line">	/*for true &#123;</span><br><span class="line">		//从channel中获取数据并打印（一般打印的数据都是乱序，调度器随意选择调度的goroutine）</span><br><span class="line">		if n, ok := &lt;-c; !ok &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*/</span><br><span class="line">	for n := range c &#123;</span><br><span class="line">		fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建worker</span><br><span class="line">func createWorker(id int) chan&lt;- int &#123;</span><br><span class="line">	c := make(chan int)</span><br><span class="line">	//这部分操作需要交给一个goroutine</span><br><span class="line">	go worker(id, c)</span><br><span class="line">	//返回一个channel</span><br><span class="line">	return c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//channel示例代码</span><br><span class="line">func chanDemo() &#123;</span><br><span class="line">	var channels [10]chan&lt;- int</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		//创建一个channel（channel是一等公民,能作为参数也能作为返回值）</span><br><span class="line">		//channels[i] = make(chan int)</span><br><span class="line">		//创建一个goroutine接收channel中的数据</span><br><span class="line">		channels[i] = createWorker(i)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- &apos;a&apos; + i</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		channels[i] &lt;- &apos;A&apos; + i</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//bufferedChannel</span><br><span class="line">func bufferedChannel() &#123;</span><br><span class="line">	c := make(chan int, 3)</span><br><span class="line">	go worker(0, c)</span><br><span class="line">	c &lt;- &apos;A&apos;</span><br><span class="line">	c &lt;- &apos;B&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//bufferedChannel</span><br><span class="line">func channelClose() &#123;</span><br><span class="line">	c := make(chan int, 3)</span><br><span class="line">	go worker(0, c)</span><br><span class="line">	c &lt;- &apos;A&apos;</span><br><span class="line">	c &lt;- &apos;B&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	c &lt;- &apos;C&apos;</span><br><span class="line">	close(c)</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//main</span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Println(&quot;Channel as first-class citizen&quot;)</span><br><span class="line">	chanDemo()</span><br><span class="line">	fmt.Println(&quot;Buffered channel&quot;)</span><br><span class="line">	bufferedChannel()</span><br><span class="line">	fmt.Println(&quot;Channel close and range&quot;)</span><br><span class="line">	channelClose()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="channel示例优化-通过通信来共享内存"><a href="#channel示例优化-通过通信来共享内存" class="headerlink" title="channel示例优化(通过通信来共享内存)"></a>channel示例优化(通过通信来共享内存)</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//worker是一个goroutine</span><br><span class="line">func doWorker(id int, c chan int, done chan bool) &#123;</span><br><span class="line">	/*for true &#123;</span><br><span class="line">		//从channel中获取数据并打印（一般打印的数据都是乱序，调度器随意选择调度的goroutine）</span><br><span class="line">		if n, ok := &lt;-c; !ok &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*/</span><br><span class="line">	for n := range c &#123;</span><br><span class="line">		fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		//通过通信来共享内存通知外面打印完成</span><br><span class="line">		//done &lt;- true</span><br><span class="line">		//channel发送数据需要在另外的goroutine中做,否则会发生阻塞</span><br><span class="line">		//go func() &#123;done&lt;-true&#125;()</span><br><span class="line">		done &lt;- true</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建worker</span><br><span class="line">func createWorker(id int) worker &#123;</span><br><span class="line">	w := worker&#123;</span><br><span class="line">		in:   make(chan int),</span><br><span class="line">		done: make(chan bool),</span><br><span class="line">	&#125;</span><br><span class="line">	//c := make(chan int)</span><br><span class="line">	//这部分操作需要交给一个goroutine</span><br><span class="line">	go doWorker(id, w.in, w.done)</span><br><span class="line">	//返回一个channel</span><br><span class="line">	return w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type worker struct &#123;</span><br><span class="line">	in   chan int</span><br><span class="line">	done chan bool</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//channel示例代码</span><br><span class="line">func chanDemo() &#123;</span><br><span class="line">	var workers [10]worker</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		//创建一个channel（channel是一等公民,能作为参数也能作为返回值）</span><br><span class="line">		//channels[i] = make(chan int)</span><br><span class="line">		//创建一个goroutine接收channel中的数据</span><br><span class="line">		workers[i] = createWorker(i)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;a&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">	&#125;</span><br><span class="line">	for _, worker := range workers &#123;</span><br><span class="line">		&lt;-worker.done</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;A&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">	&#125;</span><br><span class="line">	for _, worker := range workers &#123;</span><br><span class="line">		&lt;-worker.done</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/*for _,worker := range workers&#123;</span><br><span class="line">		&lt;-worker.done</span><br><span class="line">		&lt;-worker.done</span><br><span class="line">	&#125;*/</span><br><span class="line">	//sleep的方式很不好,我们需要通知到外面已经打印完成</span><br><span class="line">	//time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//main</span><br><span class="line">func main() &#123;</span><br><span class="line">	chanDemo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用go提供的waitGroup改进示例"><a href="#使用go提供的waitGroup改进示例" class="headerlink" title="使用go提供的waitGroup改进示例"></a>使用go提供的waitGroup改进示例</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;sync&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//worker是一个goroutine</span><br><span class="line">func doWorker(id int, c chan int, wg *sync.WaitGroup) &#123;</span><br><span class="line">	/*for true &#123;</span><br><span class="line">		//从channel中获取数据并打印（一般打印的数据都是乱序，调度器随意选择调度的goroutine）</span><br><span class="line">		if n, ok := &lt;-c; !ok &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*/</span><br><span class="line">	for n := range c &#123;</span><br><span class="line">		fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		//通过通信来共享内存通知外面打印完成</span><br><span class="line">		//done &lt;- true</span><br><span class="line">		//channel发送数据需要在另外的goroutine中做,否则会发生阻塞</span><br><span class="line">		//go func() &#123;done&lt;-true&#125;()</span><br><span class="line">		//done &lt;- true</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建worker</span><br><span class="line">func createWorker(id int,wg *sync.WaitGroup) worker &#123;</span><br><span class="line">	w := worker&#123;</span><br><span class="line">		in:   make(chan int),</span><br><span class="line">		wg: wg,</span><br><span class="line">	&#125;</span><br><span class="line">	//c := make(chan int)</span><br><span class="line">	//这部分操作需要交给一个goroutine</span><br><span class="line">	go doWorker(id, w.in, wg)</span><br><span class="line">	//返回一个channel</span><br><span class="line">	return w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type worker struct &#123;</span><br><span class="line">	in   chan int</span><br><span class="line">	wg *sync.WaitGroup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//channel示例代码</span><br><span class="line">func chanDemo() &#123;</span><br><span class="line">	//go提供的等待多任务完成的方法</span><br><span class="line">	var wg sync.WaitGroup</span><br><span class="line">	var workers [10]worker</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		//创建一个channel（channel是一等公民,能作为参数也能作为返回值）</span><br><span class="line">		//channels[i] = make(chan int)</span><br><span class="line">		//创建一个goroutine接收channel中的数据</span><br><span class="line">		workers[i] = createWorker(i,&amp;wg)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;a&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">		wg.Add(1)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;A&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">		wg.Add(1)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//main</span><br><span class="line">func main() &#123;</span><br><span class="line">	chanDemo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用函数式编程对示例进行抽象重构"><a href="#使用函数式编程对示例进行抽象重构" class="headerlink" title="使用函数式编程对示例进行抽象重构"></a>使用函数式编程对示例进行抽象重构</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;sync&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//worker是一个goroutine</span><br><span class="line">func doWorker(id int, w worker) &#123;</span><br><span class="line">	/*for true &#123;</span><br><span class="line">		//从channel中获取数据并打印（一般打印的数据都是乱序，调度器随意选择调度的goroutine）</span><br><span class="line">		if n, ok := &lt;-c; !ok &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*/</span><br><span class="line">	for n := range w.in &#123;</span><br><span class="line">		fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		//通过通信来共享内存通知外面打印完成</span><br><span class="line">		//done &lt;- true</span><br><span class="line">		//channel发送数据需要在另外的goroutine中做,否则会发生阻塞</span><br><span class="line">		//go func() &#123;done&lt;-true&#125;()</span><br><span class="line">		//done &lt;- true</span><br><span class="line">		w.done()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建worker</span><br><span class="line">func createWorker(id int, wg *sync.WaitGroup) worker &#123;</span><br><span class="line">	w := worker&#123;</span><br><span class="line">		in: make(chan int),</span><br><span class="line">		done: func() &#123;</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	//c := make(chan int)</span><br><span class="line">	//这部分操作需要交给一个goroutine</span><br><span class="line">	go doWorker(id, w)</span><br><span class="line">	//返回一个channel</span><br><span class="line">	return w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type worker struct &#123;</span><br><span class="line">	in   chan int</span><br><span class="line">	done func()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//channel示例代码</span><br><span class="line">func chanDemo() &#123;</span><br><span class="line">	//go提供的等待多任务完成的方法</span><br><span class="line">	var wg sync.WaitGroup</span><br><span class="line">	var workers [10]worker</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		//创建一个channel（channel是一等公民,能作为参数也能作为返回值）</span><br><span class="line">		//channels[i] = make(chan int)</span><br><span class="line">		//创建一个goroutine接收channel中的数据</span><br><span class="line">		workers[i] = createWorker(i, &amp;wg)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;a&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">		wg.Add(1)</span><br><span class="line">	&#125;</span><br><span class="line">	//往channel里面发送数据</span><br><span class="line">	for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">		workers[i].in &lt;- &apos;A&apos; + i</span><br><span class="line">		//现在没有sleep也能打印完成，但是是顺序打印的</span><br><span class="line">		//&lt;-workers[i].done</span><br><span class="line">		wg.Add(1)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//main</span><br><span class="line">func main() &#123;</span><br><span class="line">	chanDemo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用channel实现树的遍历"><a href="#使用channel实现树的遍历" class="headerlink" title="使用channel实现树的遍历"></a>使用channel实现树的遍历</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Node.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package tree</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func (node Node) setVal(value int) &#123;</span><br><span class="line">	node.Value = value</span><br><span class="line">&#125;</span><br><span class="line">func (node *Node) setValue(value int) &#123;</span><br><span class="line">	node.Value = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//定义类型</span><br><span class="line">type Node struct &#123;</span><br><span class="line">	Value       int</span><br><span class="line">	Left, Right *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//定义print</span><br><span class="line">func (node Node) Print() &#123;</span><br><span class="line">	fmt.Print(node.Value, &quot; &quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//遍历树</span><br><span class="line">func (node *Node) Traverse() &#123;</span><br><span class="line">	node.TraverseFunc(func(n *Node) &#123;</span><br><span class="line">		if node == nil &#123;</span><br><span class="line">			return</span><br><span class="line">		&#125;</span><br><span class="line">		n.Print()</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//遍历树同时做什么操作由传递的函数决定</span><br><span class="line">func (node *Node) TraverseFunc(f func(node *Node)) &#123;</span><br><span class="line">	if node == nil &#123;</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line">	node.Left.TraverseFunc(f)</span><br><span class="line">	f(node)</span><br><span class="line">	node.Right.TraverseFunc(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用channel对树进行遍历</span><br><span class="line">func (node *Node) TraverseWithChannel() chan *Node &#123;</span><br><span class="line">	out := make(chan *Node)</span><br><span class="line">	go func() &#123;</span><br><span class="line">		node.TraverseFunc(</span><br><span class="line">			func(node *Node) &#123;</span><br><span class="line">				out &lt;- node</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">		close(out)</span><br><span class="line">	&#125;()</span><br><span class="line">	return out</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line">main.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;world.ismyfree/go-learning/tree&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	root := tree.Node&#123;Value: 3&#125;</span><br><span class="line">	root.Left = &amp;tree.Node&#123;&#125;</span><br><span class="line">	root.Right = &amp;tree.Node&#123;Value: 5&#125;</span><br><span class="line">	root.Left.Right = &amp;tree.Node&#123;Value: 2&#125;</span><br><span class="line">	root.Right.Left = &amp;tree.Node&#123;Value: 4&#125;</span><br><span class="line">	root.Traverse()</span><br><span class="line">	count := 0</span><br><span class="line">	root.TraverseFunc(func(node *tree.Node) &#123;</span><br><span class="line">		count++</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(&quot;Node count: &quot;, count)</span><br><span class="line"></span><br><span class="line">	//使用channel遍历树获取最大值</span><br><span class="line">	c := root.TraverseWithChannel()</span><br><span class="line">	maxNode := 0</span><br><span class="line">	for node := range c &#123;</span><br><span class="line">		if node.Value &gt; maxNode &#123;</span><br><span class="line">			maxNode = node.Value</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&quot;Max node value:&quot;, maxNode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用select方式对chnnel进行调度"><a href="#使用select方式对chnnel进行调度" class="headerlink" title="使用select方式对chnnel进行调度"></a>使用select方式对chnnel进行调度</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;math/rand&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//worker是一个goroutine</span><br><span class="line">func worker(id int, c chan int) &#123;</span><br><span class="line">	/*for true &#123;</span><br><span class="line">		//从channel中获取数据并打印（一般打印的数据都是乱序，调度器随意选择调度的goroutine）</span><br><span class="line">		if n, ok := &lt;-c; !ok &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			fmt.Printf(&quot;worker %d received %c\n&quot;, id, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*/</span><br><span class="line">	for n := range c &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		fmt.Printf(&quot;worker %d received %d\n&quot;, id, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建worker</span><br><span class="line">func createWorker(id int) chan&lt;- int &#123;</span><br><span class="line">	c := make(chan int)</span><br><span class="line">	//这部分操作需要交给一个goroutine</span><br><span class="line">	go worker(id, c)</span><br><span class="line">	//返回一个channel</span><br><span class="line">	return c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func generator() chan int &#123;</span><br><span class="line">	out := make(chan int)</span><br><span class="line">	go func() &#123;</span><br><span class="line">		i := 0</span><br><span class="line">		for true &#123;</span><br><span class="line">			time.Sleep(time.Duration(rand.Intn(1500)) * time.Millisecond)</span><br><span class="line">			out &lt;- i</span><br><span class="line">			i++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	return out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	var c1, c2 = generator(), generator()</span><br><span class="line">	var worker = createWorker(0)</span><br><span class="line">	var values []int</span><br><span class="line">	//10s后往这个channel发送时间</span><br><span class="line">	afterTenSecond := time.After(10 * time.Second)</span><br><span class="line">	//每秒往这个</span><br><span class="line">	tick := time.Tick(time.Second)</span><br><span class="line">	for true &#123;</span><br><span class="line">		var activeWorker chan&lt;- int</span><br><span class="line">		var activeValue int</span><br><span class="line">		if len(values) &gt; 0 &#123;</span><br><span class="line">			activeWorker = worker</span><br><span class="line">			activeValue = values[0]</span><br><span class="line">		&#125;</span><br><span class="line">		select &#123;</span><br><span class="line">		case n := &lt;-c1:</span><br><span class="line">			values = append(values, n)</span><br><span class="line">		case n := &lt;-c2:</span><br><span class="line">			values = append(values, n)</span><br><span class="line">		case activeWorker &lt;- activeValue:</span><br><span class="line">			values = values[1:]</span><br><span class="line">		case &lt;-time.After(500 * time.Millisecond):</span><br><span class="line">			//每次进寻魂生成数据超过500毫秒打印time out</span><br><span class="line">			fmt.Println(&quot;time out&quot;)</span><br><span class="line">		case &lt;-tick:</span><br><span class="line">			fmt.Println(&quot;queue len = &quot;, len(values))</span><br><span class="line">		case &lt;-afterTenSecond:</span><br><span class="line">			//10s后冲这个channel获取到数据结束程序</span><br><span class="line">			fmt.Println(&quot;Bye&quot;)</span><br><span class="line">			return</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="传统同步机制"><a href="#传统同步机制" class="headerlink" title="传统同步机制"></a>传统同步机制</h3><blockquote>
<p>WaitGroup</p>
</blockquote>
<blockquote>
<p>Mutex(互斥量)</p>
</blockquote>
<blockquote>
<p>cond(条件变量)</p>
</blockquote>
<h4 id="Mutex示例-真实操作请使用系统库提供的原子操作，这里仅作为示例"><a href="#Mutex示例-真实操作请使用系统库提供的原子操作，这里仅作为示例" class="headerlink" title="Mutex示例(真实操作请使用系统库提供的原子操作，这里仅作为示例)"></a>Mutex示例(真实操作请使用系统库提供的原子操作，这里仅作为示例)</h4><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;sync&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type atomicInt struct &#123;</span><br><span class="line">	value int</span><br><span class="line">	lock sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (a *atomicInt) increment() &#123;</span><br><span class="line">	fmt.Println(&quot;safe increment&quot;)</span><br><span class="line">	func()&#123;</span><br><span class="line">		a.lock.Lock()</span><br><span class="line">		defer a.lock.Unlock()</span><br><span class="line">		a.value++</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (a *atomicInt) get() int &#123;</span><br><span class="line">	a.lock.Lock()</span><br><span class="line">	defer a.lock.Unlock()</span><br><span class="line">	return a.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	var a atomicInt</span><br><span class="line">	a.increment()</span><br><span class="line">	go func() &#123;</span><br><span class="line">		a.increment()</span><br><span class="line">	&#125;()</span><br><span class="line">	time.Sleep(time.Millisecond)</span><br><span class="line">	fmt.Println(a.get())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="http及其它标准库"><a href="#http及其它标准库" class="headerlink" title="http及其它标准库"></a>http及其它标准库</h1><h2 id="httpClient示例"><a href="#httpClient示例" class="headerlink" title="httpClient示例"></a>httpClient示例</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;net/http/httputil&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	request, err := http.NewRequest(http.MethodGet, &quot;https://www.imooc.com&quot;, nil)</span><br><span class="line">	//控制请求的头部信息</span><br><span class="line">	request.Header.Add(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1&quot;)</span><br><span class="line">	//自己构建客户端打印重定向时候的操作</span><br><span class="line">	client := http.Client&#123;</span><br><span class="line">		CheckRedirect: func(req *http.Request, via []*http.Request) error &#123;</span><br><span class="line">			fmt.Println(&quot;Redirect&quot;, req)</span><br><span class="line">			return nil</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	//我们使用自己构建的client</span><br><span class="line">	resp, err := client.Do(request)</span><br><span class="line">	//resp, err := http.DefaultClient.Do(request)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer resp.Body.Close()</span><br><span class="line">	//使用httputil简化工作</span><br><span class="line">	s, err := httputil.DumpResponse(resp, true)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(&quot;%s\n&quot;,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="httpServer性能分析"><a href="#httpServer性能分析" class="headerlink" title="httpServer性能分析"></a>httpServer性能分析</h2><blockquote>
<p>在程序中import _ “net/http/pprof”</p>
</blockquote>
<blockquote>
<p>在浏览器中打开接口路径为/debug/pprof/的请求</p>
</blockquote>
<p><img src="/images/img_18.png" alt="http pprof工具"></p>
<blockquote>
<p>使用命令行pprof工具获得程序30秒的性能访问权限(30秒内随意访问服务的接口)</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:8888/debug/pprof/profile</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上命令操作完后输入web以图形化界面进行分析程序（需要安装Graphviz）</p>
</blockquote>
<blockquote>
<p>也可以使用如下命令查看内存使用情况</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:8888/debug/pprof/profile</span><br></pre></td></tr></table></figure>

<h2 id="其它标准库"><a href="#其它标准库" class="headerlink" title="其它标准库"></a>其它标准库</h2><h3 id="常用标准库"><a href="#常用标准库" class="headerlink" title="常用标准库"></a>常用标准库</h3><blockquote>
<p>bufio</p>
</blockquote>
<blockquote>
<p>log</p>
</blockquote>
<blockquote>
<p>encoding/json</p>
</blockquote>
<blockquote>
<p>regexp</p>
</blockquote>
<blockquote>
<p>time</p>
</blockquote>
<blockquote>
<p>strings/math/rand</p>
</blockquote>
<h3 id="起一个服务查看标准库文档"><a href="#起一个服务查看标准库文档" class="headerlink" title="起一个服务查看标准库文档"></a>起一个服务查看标准库文档</h3><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">godoc -http=:6060</span><br></pre></td></tr></table></figure>

<h3 id="中文标准库网址"><a href="#中文标准库网址" class="headerlink" title="中文标准库网址"></a>中文标准库网址</h3><p>点此进行跳转<strong><a href="https://studygolang.com/pkgdoc" target="_blank" rel="noopener">go中文api</a></strong></p>
<h1 id="迷宫的广度优先搜索"><a href="#迷宫的广度优先搜索" class="headerlink" title="迷宫的广度优先搜索"></a>迷宫的广度优先搜索</h1><p><img src="/images/img_19.png" alt="迷宫示意图"></p>
<blockquote>
<p>0代表可以走的地方</p>
</blockquote>
<blockquote>
<p>1代表墙</p>
</blockquote>
<blockquote>
<p>人为规定入口和出口为左上角和右下角</p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><blockquote>
<p>想想我们在一个未知的世界</p>
</blockquote>
<p><img src="/images/img_20.png" alt="第0步"></p>
<blockquote>
<p>顺序探索并放入未探索队列当中(上左下右)</p>
</blockquote>
<p><img src="/images/img_21.png" alt="第1步"></p>
<blockquote>
<p>每探索一个移除未探索队列并将新探索到未探索的加入队列中</p>
</blockquote>
<p><img src="/images/img_22.png" alt="第2步上"></p>
<p><img src="/images/img_23.png" alt="第2步左"></p>
<p><img src="/images/img_24.png" alt="第2步下"></p>
<p><img src="/images/img_25.png" alt="第2步右"></p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">maze.in</span><br><span class="line">------------------------------------------------------</span><br><span class="line">6 5</span><br><span class="line">0 1 0 0 0</span><br><span class="line">0 0 0 1 0</span><br><span class="line">0 1 0 1 0</span><br><span class="line">1 1 1 0 0</span><br><span class="line">0 1 0 0 1</span><br><span class="line">0 1 0 0 0</span><br><span class="line">------------------------------------------------------</span><br><span class="line">maze.go</span><br><span class="line">------------------------------------------------------</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//读取迷宫文件</span><br><span class="line">func readMaze(filename string) [][]int &#123;</span><br><span class="line">	file, err := os.Open(filename)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	//定义行列临时变量</span><br><span class="line">	var row, col int</span><br><span class="line">	//扫描第一行获取文件的行列数(\n读换行)</span><br><span class="line">	fmt.Fscanf(file, &quot;%d %d\n&quot;, &amp;row, &amp;col)</span><br><span class="line">	//创建第一维slice</span><br><span class="line">	maze := make([][]int, row)</span><br><span class="line">	for i := range maze &#123;</span><br><span class="line">		//创建第二维slice</span><br><span class="line">		maze[i] = make([]int, col)</span><br><span class="line">		//将数据放到二维slice中的每一个元素中</span><br><span class="line">		for j := range maze[i] &#123;</span><br><span class="line">			a := &amp;maze[i][j]</span><br><span class="line">			if j == len(maze[i])-1 &#123;</span><br><span class="line">				//(\n读换行)</span><br><span class="line">				fmt.Fscanf(file, &quot;%d\n&quot;, a)</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				fmt.Fscanf(file, &quot;%d&quot;, a)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return maze</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type point struct &#123;</span><br><span class="line">	i, j int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//移动(上左下右)</span><br><span class="line">var dirs = [4]point&#123;</span><br><span class="line">	&#123;-1, 0&#125;,</span><br><span class="line">	&#123;0, -1&#125;,</span><br><span class="line">	&#123;1, 0&#125;,</span><br><span class="line">	&#123;0, 1&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//移动add</span><br><span class="line">func (p point) add(r point) point &#123;</span><br><span class="line">	return point&#123;p.i + r.i, p.j + r.j&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//at校验当前位置</span><br><span class="line">func (p point) at(grid [][]int) (int, bool) &#123;</span><br><span class="line">	//往上走或者往下走越界的时候</span><br><span class="line">	if p.i &lt; 0 || p.i &gt;= len(grid) &#123;</span><br><span class="line">		return 0, false</span><br><span class="line">	&#125;</span><br><span class="line">	//往左走或者往右走越界的时候</span><br><span class="line">	if p.j &lt; 0 || p.j &gt;= len(grid[p.i]) &#123;</span><br><span class="line">		return 0, false</span><br><span class="line">	&#125;</span><br><span class="line">	return grid[p.i][p.j],true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//走迷宫</span><br><span class="line">func walk(maze [][]int, start, end point) [][]int&#123;</span><br><span class="line">	//要走的每一步</span><br><span class="line">	steps := make([][]int, len(maze))</span><br><span class="line">	for i := range steps &#123;</span><br><span class="line">		steps[i] = make([]int, len(maze[i]))</span><br><span class="line">	&#125;</span><br><span class="line">	//将起点放入队列当中</span><br><span class="line">	Q := []point&#123;start&#125;</span><br><span class="line"></span><br><span class="line">	for len(Q) &gt; 0 &#123;</span><br><span class="line">		//取出队列中当前的位置作为要探索的点</span><br><span class="line">		cur := Q[0]</span><br><span class="line">		Q = Q[1:]</span><br><span class="line">		//判断当前探索点是否是终点</span><br><span class="line">		if cur == end &#123;</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">		for _, dir := range dirs &#123;</span><br><span class="line">			next := cur.add(dir)</span><br><span class="line">			//如果越界或者撞墙,继续探索</span><br><span class="line">			val, ok := next.at(maze)</span><br><span class="line">			if !ok || val == 1 &#123;</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">			//如果当前有值说明已经有值了，继续探索</span><br><span class="line">			val, ok = next.at(steps)</span><br><span class="line">			if !ok || val != 0 &#123;</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">			//如果当前点在起点继续探索</span><br><span class="line">			if next == start &#123;</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">			//探索(需要做的事：1.探索到的下一步填上是第几步2.将探索到的下一步加入到队列)</span><br><span class="line">			curSteps, _ := cur.at(steps)</span><br><span class="line">			steps[next.i][next.j] = curSteps + 1</span><br><span class="line">			Q = append(Q, next)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return steps</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	maze := readMaze(&quot;maze/maze.in&quot;)</span><br><span class="line">	fmt.Println(&quot;print maze&quot;)</span><br><span class="line">	fmt.Println(&quot;-----------------------&quot;)</span><br><span class="line">	//打印读取出来的数据</span><br><span class="line">	for _, row := range maze &#123;</span><br><span class="line">		for _, val := range row &#123;</span><br><span class="line">			fmt.Printf(&quot;%d &quot;, val)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&quot;-----------------------&quot;)</span><br><span class="line">	fmt.Println(&quot;print steps&quot;)</span><br><span class="line">	fmt.Println(&quot;-----------------------&quot;)</span><br><span class="line">	//走迷宫</span><br><span class="line">	steps := walk(maze, point&#123;0, 0&#125;, point&#123;len(maze) - 1, len(maze[0]) - 1&#125;)</span><br><span class="line">	for _,row := range steps &#123;</span><br><span class="line">		for _, val := range row &#123;</span><br><span class="line">			fmt.Printf(&quot;%3d &quot;,val)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&quot;-----------------------&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>打印结果</p>
</blockquote>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">print maze</span><br><span class="line">-----------------------</span><br><span class="line">0 1 0 0 0 </span><br><span class="line">0 0 0 1 0 </span><br><span class="line">0 1 0 1 0 </span><br><span class="line">1 1 1 0 0 </span><br><span class="line">0 1 0 0 1 </span><br><span class="line">0 1 0 0 0 </span><br><span class="line">-----------------------</span><br><span class="line">print steps</span><br><span class="line">-----------------------</span><br><span class="line">  0   0   4   5   6 </span><br><span class="line">  1   2   3   0   7 </span><br><span class="line">  2   0   4   0   8 </span><br><span class="line">  0   0   0  10   9 </span><br><span class="line">  0   0  12  11   0 </span><br><span class="line">  0   0  13  12  13 </span><br><span class="line">-----------------------</span><br></pre></td></tr></table></figure>
      
    </main>
    <footer class="post-footer">
      
    </footer>
  </article>
  
  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-angle-right" aria-label="下一页"></i></a>
  </nav>
  
  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="搜索" class="form-control">
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/images/tanliyuan_katong.jpg" alt="Tan Liyuan">
  
  <h1 class="author-name">Tan Liyuan</h1>
  <h2 class="author-description">一个热爱生活的小男孩</h2>
  <div class="site-count">
    
    
    
    
    <div class="archives-count count-block">
      <div class="site-count-title">归档</div>
      <div><a href="/archives/">31</a></div>
    </div>
    
    
    
    <div class="categories-count count-block">
      <div class="site-count-title">分类</div>
      <div><a href="/categories/">12</a></div>
    </div>
    
    
    
    <div class="tags-count count-block">
      <div class="site-count-title">标签</div>
      <div><a href="/tags/">16</a></div>
    </div>
    
    
    
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    <hr>
    <div class="social-link sidebar-item">
      <div><i class="far fa-address-card"></i>社交链接<p></p></div>
      <ul>
        
        <li><i class="fas fa-envelope"></i><a href="mailto:15803657214@163.com" target="_blank">E-Mail</a></li>
        
        <li><i class="fab fa-github"></i><a href="https://github.com/developertanliyuan/" target="_blank">GitHub</a></li>
        
        <li><i class="fab fa-weibo"></i><a href="https://weibo.com/u/577007836" target="_blank">Weibo</a></li>
        
      </ul>
    </div>
    
    
    <hr>
    <div class="blogroll sidebar-item">
      <div><i class="fas fa-link"></i>友情链接</div>
      <ul>
        
        <li><i class="fa fa-paperclip"></i><a href="https://sh.alynx.one/" target="_blank">喵's StackHarbor</a></li>
        
        <li><i class="fa fa-paperclip"></i><a href="http://www.dyboy.cn/" target="_blank">第一资源网</a></li>
        
        <li><i class="fa fa-paperclip"></i><a href="https://info.liuwenhao.store/" target="_blank">刘文豪的个人主页</a></li>
        
      </ul>
    </div>
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">Tan Liyuan</span><span class="year"><i class="far fa-copyright"></i>2022</span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
        </div>
        <div class="powered-by">
          由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>
